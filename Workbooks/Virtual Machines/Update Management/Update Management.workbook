{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "67ac9ca1-fe99-42df-9df0-66b662efb498",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 86400000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            },
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.compute/virtualmachines"
      },
      "name": "parameters - time range"
    },
    {
      "type": 1,
      "content": {
        "json": "Click on the pie chart or table rows to get started",
        "style": "info"
      },
      "name": "text - 8"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Update\r\n| summarize count() by Classification",
        "size": 2,
        "timeContext": {
          "durationMs": 86400000
        },
        "timeContextFromParameter": "TimeRange",
        "exportMultipleValues": true,
        "exportedParameters": [
          {
            "fieldName": "series",
            "parameterName": "classification",
            "parameterType": 1
          }
        ],
        "queryType": 0,
        "resourceType": "microsoft.compute/virtualmachines",
        "visualization": "piechart"
      },
      "customWidth": "33",
      "name": "query - pie chart"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "e42e9a59-56fb-411f-afcc-6457536f61c3",
            "version": "KqlParameterItem/1.0",
            "name": "blank",
            "type": 1,
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "16fb5e3a-3992-4c04-b1bd-fe1989e43e98",
            "version": "KqlParameterItem/1.0",
            "name": "classificationSnippet",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "classification",
                  "operator": "isNotNull",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "| where Classification in ({classification})"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "param",
                  "resultVal": "blank"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "true",
        "comparison": "isEqualTo",
        "value": "false"
      },
      "name": "parameters - hidden"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let updates = Update {classificationSnippet};\r\nupdates\r\n| extend Title = case(isempty(Title), \"Untitled\", Title)\r\n| order by TimeGenerated desc",
        "size": 0,
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "exportedParameters": [
          {
            "parameterName": "update",
            "parameterType": 1
          },
          {
            "fieldName": "Title",
            "parameterName": "title",
            "parameterType": 1,
            "defaultValue": "Untitled"
          },
          {
            "fieldName": "TimeGenerated",
            "parameterName": "timeGenerated",
            "parameterType": 1
          },
          {
            "fieldName": "Classification",
            "parameterName": "classification",
            "parameterType": 1
          },
          {
            "fieldName": "UpdateState",
            "parameterName": "updateState",
            "parameterType": 1
          },
          {
            "fieldName": "Product",
            "parameterName": "product",
            "parameterType": 1
          },
          {
            "fieldName": "OSType",
            "parameterName": "ostype",
            "parameterType": 1
          },
          {
            "fieldName": "ProductVersion",
            "parameterName": "productversion",
            "parameterType": 1
          },
          {
            "fieldName": "ProductArch",
            "parameterName": "productarch",
            "parameterType": 1
          },
          {
            "fieldName": "CVENumbers",
            "parameterName": "cvenumbers",
            "parameterType": 1
          },
          {
            "fieldName": "BulletinUrl",
            "parameterName": "bulletinurl",
            "parameterType": 1
          },
          {
            "fieldName": "BulletinID",
            "parameterName": "bulletinid",
            "parameterType": 1
          },
          {
            "fieldName": "PackageRepository",
            "parameterName": "packagerepository",
            "parameterType": 1
          },
          {
            "fieldName": "PackageSeverity",
            "parameterName": "packageseverity",
            "parameterType": 1
          },
          {
            "fieldName": "OSName",
            "parameterName": "osname",
            "parameterType": 1
          },
          {
            "fieldName": "OSVersion",
            "parameterName": "osversion",
            "parameterType": 1
          },
          {
            "fieldName": "OSFullName",
            "parameterName": "osfullname",
            "parameterType": 1
          },
          {
            "fieldName": "MSRCSeverity",
            "parameterName": "msrcseverity",
            "parameterType": 1
          },
          {
            "fieldName": "KBID",
            "parameterName": "kbid",
            "parameterType": 1
          },
          {
            "fieldName": "UpdateID",
            "parameterName": "updateid",
            "parameterType": 1
          },
          {
            "fieldName": "RevisionNumber",
            "parameterName": "revisionnumber",
            "parameterType": 1
          },
          {
            "fieldName": "MSRCBulletinID",
            "parameterName": "msrcbulletinid",
            "parameterType": 1
          }
        ],
        "queryType": 0,
        "resourceType": "microsoft.compute/virtualmachines",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "TenantId",
              "formatter": 5
            },
            {
              "columnMatch": "SourceSystem",
              "formatter": 5
            },
            {
              "columnMatch": "TimeGenerated",
              "formatter": 6
            },
            {
              "columnMatch": "SourceComputerId",
              "formatter": 5
            },
            {
              "columnMatch": "Title",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "50%"
              }
            },
            {
              "columnMatch": "PublishedDate",
              "formatter": 5
            },
            {
              "columnMatch": "Computer",
              "formatter": 5
            },
            {
              "columnMatch": "Product",
              "formatter": 5
            },
            {
              "columnMatch": "OSType",
              "formatter": 5
            },
            {
              "columnMatch": "ProductVersion",
              "formatter": 5
            },
            {
              "columnMatch": "ProductArch",
              "formatter": 5
            },
            {
              "columnMatch": "CVENumbers",
              "formatter": 5
            },
            {
              "columnMatch": "BulletinUrl",
              "formatter": 5
            },
            {
              "columnMatch": "BulletinID",
              "formatter": 5
            },
            {
              "columnMatch": "PackageRepository",
              "formatter": 5
            },
            {
              "columnMatch": "PackageSeverity",
              "formatter": 5
            },
            {
              "columnMatch": "OSName",
              "formatter": 5
            },
            {
              "columnMatch": "OSVersion",
              "formatter": 5
            },
            {
              "columnMatch": "OSFullName",
              "formatter": 5
            },
            {
              "columnMatch": "SubscriptionId",
              "formatter": 5
            },
            {
              "columnMatch": "ResourceGroup",
              "formatter": 5
            },
            {
              "columnMatch": "ResourceProvider",
              "formatter": 5
            },
            {
              "columnMatch": "Resource",
              "formatter": 5
            },
            {
              "columnMatch": "ResourceId",
              "formatter": 5
            },
            {
              "columnMatch": "ResourceType",
              "formatter": 5
            },
            {
              "columnMatch": "VMUUID",
              "formatter": 5
            },
            {
              "columnMatch": "MG",
              "formatter": 5
            },
            {
              "columnMatch": "ManagementGroupName",
              "formatter": 5
            },
            {
              "columnMatch": "MSRCSeverity",
              "formatter": 5
            },
            {
              "columnMatch": "KBID",
              "formatter": 5
            },
            {
              "columnMatch": "UpdateID",
              "formatter": 5
            },
            {
              "columnMatch": "RevisionNumber",
              "formatter": 5
            },
            {
              "columnMatch": "Optional",
              "formatter": 5
            },
            {
              "columnMatch": "RebootBehavior",
              "formatter": 5
            },
            {
              "columnMatch": "Approved",
              "formatter": 5
            },
            {
              "columnMatch": "ApprovalSource",
              "formatter": 5
            },
            {
              "columnMatch": "InstallTimePredictionSeconds",
              "formatter": 5
            },
            {
              "columnMatch": "InstallTimeDeviationRangeSeconds",
              "formatter": 5
            },
            {
              "columnMatch": "InstallTimeAvailable",
              "formatter": 5
            },
            {
              "columnMatch": "Type",
              "formatter": 5
            },
            {
              "columnMatch": "_ResourceId",
              "formatter": 5
            }
          ],
          "rowLimit": 10000
        }
      },
      "customWidth": "67",
      "name": "query - updates table"
    },
    {
      "type": 1,
      "content": {
        "json": "{title}\r\n--\r\n_{timeGenerated}_"
      },
      "conditionalVisibility": {
        "parameterName": "update",
        "comparison": "isNotEqualTo"
      },
      "name": "text - update title"
    },
    {
      "type": 1,
      "content": {
        "json": "* Classification: {classification}\r\n* Update State: {updateState}\r\n* Update ID: {updateid}\r\n\r\n---\r\n\r\n* CVE Numbers: {cvenumbers}\r\n* BulletinID: {bulletinid}\r\n* BulletinUrl: {bulletinurl}\r\n\r\n---\r\n\r\n* MSRC Severity: {msrcseverity}\r\n* MSRC Bulletin ID: {msrcbulletinid}\r\n* KB ID: {kbid}"
      },
      "conditionalVisibility": {
        "parameterName": "update",
        "comparison": "isNotEqualTo"
      },
      "customWidth": "33",
      "name": "text - update classification"
    },
    {
      "type": 1,
      "content": {
        "json": "* Package Severity: {packageseverity}\r\n* Package Repository: {packagerepository}\r\n\r\n---\r\n\r\n* Product: {product}\r\n* ProductVersion: {productversion}\r\n* ProductArch: {productarch}"
      },
      "conditionalVisibility": {
        "parameterName": "update",
        "comparison": "isNotEqualTo"
      },
      "customWidth": "34",
      "name": "text - update package"
    },
    {
      "type": 1,
      "content": {
        "json": "* OS: {osfullname}\r\n\r\n---\r\n\r\n* OS Name: {osname}\r\n* OS Version: {osversion}"
      },
      "conditionalVisibility": {
        "parameterName": "update",
        "comparison": "isNotEqualTo"
      },
      "customWidth": "33",
      "name": "text - update system"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
