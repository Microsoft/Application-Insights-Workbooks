{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "0961d4d9-6c59-45b6-9f74-72db4895bc7b",
            "version": "KqlParameterItem/1.0",
            "name": "Resource",
            "type": 5,
            "isRequired": true,
            "value": null,
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.insights/components": true
              },
              "additionalResourceOptions": [],
              "showDefault": false
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.insights/components"
      },
      "name": "Resource Parameters"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "495f4050-6f47-4117-a855-427ef18dc154",
            "version": "KqlParameterItem/1.0",
            "name": "Time",
            "type": 2,
            "isRequired": true,
            "query": "let Table=datatable(value:timespan, text:string, item_order:long)[\r\n24h, 'Last 24 hours', 1,\r\n3d, 'Last 3 days', 2,\r\n7d, 'Last 7 days', 3,\r\n30d, 'Last 30 days', 4,\r\n60d, 'Last 60 days', 5,\r\n90d, 'Last 90 days', 5,\r\n];\r\nlet View_1 = view () { print value=startofmonth(now()), text=\"This calendar month\", item_order=6};\r\nlet View_2 = view () { print value=startofmonth(datetime_add(\"month\", -1, now())), text=\"Last 2 calendar months\", item_order=7};\r\nlet View_3 = view () { print value=startofmonth(datetime_add(\"month\", -2, now())), text=\"Last 3 calendar months\", item_order=8};\r\nlet View_6 = view () { print value=startofmonth(datetime_add(\"month\", -6, now())), text=\"Last 6 calendar months\", item_order=9};\r\nlet View_13 = view () { print value=startofmonth(datetime_add(\"month\", -13, now())), text=\"Last 13 calendar months\", item_order=10};\r\nTable\r\n| project value=now() - value, text, item_order\r\n| union View_1, View_2, View_3, View_6, View_13\r\n| order by item_order asc\r\n| project value, text",
            "value": "2021-05-01T00:00:00Z",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          },
          {
            "id": "9e1d8606-09ba-4754-8321-330814617d16",
            "version": "KqlParameterItem/1.0",
            "name": "ConversionScope",
            "type": 2,
            "description": "Select Authenticated Users (most accurate) if user_AuthenticatedId is available. Otherwise, select Anonymous Users (least accurate) based on anonymous user_Id.",
            "isRequired": true,
            "query": "datatable(key:string, display:string)\r\n[\r\n\"user_Id\", \"Anonymous Users\", \r\n\"user_AuthenticatedId\", \"Authenticated Users\",\r\n]",
            "value": "user_AuthenticatedId",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          },
          {
            "id": "da97155d-2a5d-4bb5-a404-bbac696e48c7",
            "version": "KqlParameterItem/1.0",
            "name": "Country",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "union pageViews, customEvents\r\n| summarize by client_CountryOrRegion\r\n| where isnotempty(client_CountryOrRegion)\r\n| project value=client_CountryOrRegion, label=client_CountryOrRegion, r=1\r\n| union (\r\ndatatable(value:string, label:string, r:long)[\r\n\"*\", \"All Countries\", 0\r\n])\r\n| order by r asc, label asc\r\n| project value, label",
            "value": [
              "*"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          },
          {
            "id": "6ffd17a5-c99f-4023-933f-bed2fb80797d",
            "version": "KqlParameterItem/1.0",
            "name": "OS",
            "label": "Operating System",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "union pageViews, customEvents\r\n| summarize by client_OS\r\n| where isnotempty(client_OS)\r\n| project value=client_OS, label=client_OS, r=1\r\n| union (\r\ndatatable(value:string, label:string, r:long)[\r\n\"*\", \"All Operating Systems\", 0\r\n])\r\n| order by r asc, label asc\r\n| project value, label",
            "value": [
              "*"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          },
          {
            "id": "09eab8d5-23a9-43e8-8496-0405c2e457ce",
            "version": "KqlParameterItem/1.0",
            "name": "Browser",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "union pageViews, customEvents\r\n| summarize by client_Browser, group=tostring(split(client_Browser, \" \", 0)[0])\r\n| where isnotempty(client_Browser)\r\n| project value=client_Browser, label=client_Browser, group=tostring(split(client_Browser, \" \", 0)[0]), r=1, selected=false\r\n| union (\r\ndatatable(value:string, label:string, group:string, selected: bool, r:long)[\r\n\"*\", \"All Browsers\", \"All\", true, 0\r\n])\r\n| order by r asc, label asc\r\n| project value, label, group, selected",
            "value": [
              "*"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.insights/components"
      },
      "name": "Workbook Parameters"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "ce75a159-b005-424e-ac71-bff10eed3b97",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Summary",
            "subTarget": "HEART Overview",
            "style": "link"
          },
          {
            "id": "27dab657-c150-47c5-8a5f-b73b0d1dc928",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Adoption",
            "subTarget": "Adoption",
            "style": "link"
          },
          {
            "id": "6e195d77-85b7-4889-a32c-86895244e337",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Engagement",
            "subTarget": "Engagement",
            "style": "link"
          },
          {
            "id": "574c36fc-3aa9-44e9-8f1b-0c44728ee02d",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Retention",
            "subTarget": "Retention",
            "style": "link"
          },
          {
            "id": "76c92d09-38fa-42c1-877a-9d73ce5a435c",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Task Success",
            "subTarget": "Task Success",
            "style": "link"
          },
          {
            "id": "f21fcfe2-7dfa-4ac0-92bf-c637a4545921",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Happiness",
            "subTarget": "Happiness",
            "style": "link"
          },
          {
            "id": "8b97dc75-0ecc-45e8-aa11-675cd1697888",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Feature Metrics",
            "subTarget": "Feature",
            "style": "link"
          },
          {
            "id": "3a770d7b-f7cc-4f67-8f88-595d7aef489b",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Development Requirements",
            "subTarget": "Technical",
            "style": "link"
          }
        ]
      },
      "name": "Tabs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Overview",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# HEART \n---\nA user engagement framework that enables holistic measurement of user experience by focusing on 5 dimensions captured through telemetry data.\n\nThe 5 dimensions of HEART enable measurement of **H**appiness, **E**ngagement, **A**doption, **R**etention & **T**ask Success.\n\nAdoption, Engagement, and Retention form a user activity funnel: Adoption -> Engagement -> Retention. Some users will load the application (**Adoption**). A subset of those users will then choose to click on a component within the app, such as a button (**Engagement**). Some of the users active in the application will choose to return (**Retention**). Completing **tasks successfully** drives users down this funnel: users will choose to come back to the application if they are productive in the application. Finally, **Happiness** is the outcome of the other 4 dimensions. A product owner can measure how effectively the product converts adopted users to retained users with Happiness: users who progress down the Adoption -> Engagement -> Retention funnel and complete tasks successfully will show higher satisfaction.\n\n\nThe HEART Framework uses the [Click Analytics plugin for Application Insights](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin). To calculate HEART Metrics, **the Click Analytics plugin must be implemented in the application.** Visit the **Development Requirements** tab to learn more about telemetry implementation."
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "HEART Overview"
            },
            "name": "Overview"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "HEART Overview"
      },
      "name": "HEART Summary Title"
    },
    {
      "type": 1,
      "content": {
        "json": "## HEART Metrics: User Activity Funnel\r\n---\r\nThe below KPIs represent a subset of HEART Metrics. These visuals describe the user activity funnel: Adoption -> Engagement -> Retention.\r\n\r\n"
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "HEART Overview"
      },
      "name": "HEART Metrics Title"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Adoption Overview",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Adoption\r\n\r\n### Measuring Adoption\r\nThe Adoption dimension measures how quickly an application is gaining new users. For this reason, Adoption metrics are especially useful for measuring the below scenarios:  \r\na. newly released products  \r\nb. newly updated products  \r\nc. marketing campaigns  \r\n\r\nAn example of the marketing campaign scenario: a product team wants more employees in the organization to register for their application, so they share an organization-wide email with a link to this application. The product team can analyze Adoption metrics to understand how effective this email was in converting employees to log into the application for the first time.\r\n\r\n\r\n### Defining Adoption\r\nAny user who has loaded or visited the experience is considered an aware user (regardless of whether or not they have clicked anything in the experience)."
            },
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Adoption"
            },
            "name": "Adoption Text"
          },
          {
            "type": 1,
            "content": {
              "json": "| Metric                 | Definition                                                                          | Question Answered                                      |\r\n|------------------------|-------------------------------------------------------------------------------------|--------------------------------------------------------|\r\n| Aware Users            | Count of users who have loaded or visited the experience.                           | How many users are showing interest in the experience? |\r\n| Net New Aware Users    | Count of Aware Users who have visited the experience for the first time.            | How quickly is the experience gaining new users?       |\r\n| Cumulative Aware Users | Count of Aware Users who have visited the experience over the selected time period. | How has the interested user-base grown over time?      |\r\n\r\n---"
            },
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Adoption"
            },
            "name": "Adoption Metric Definitions"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Adoption"
      },
      "name": "Adoption Overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Engagement Overview",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Engagement\r\n### Measuring Engagement\r\nIt is challenging to measure engagement generically because engagement is driven both by expected usage and actual usage. While an experience such as Microsoft Teams would have high daily usage as employees rely on Teams for daily communication, other experiences might expect usage at a weekly or even monthly cadence (such as a rent payment portal). For this reason, the HEART Framework measures engagement using the concept of Active Users (users who voluntarily interact with the experinces) and will be assessing engagement by breaking active usage down into 3 sub-dimensions: \r\n1. Activity Depth – How many features are users leveraging each time the user interacts with the experience?\r\n2. Activity Breadth – Over a given time period, how many features of the experience is a user leveraging?\r\n3. Activity Frequency – How often does a user interact with the experience – daily, weekly, monthly?\r\n\r\n### Defining Active Users\t\r\nAny user who performs a user-initiated action like clicking a button, typing an input, etc. is counted as an Active User. While Aware Users includes all users who have loaded the experience, Active Users must have performed an intentional action. This workbook considers any telemetry event with an actionType as an \"intentional action\". **For this reason, Engagement metrics require the [Click Analytics plugin for Application Insights](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin) implemented in the application**."
            },
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Engagement"
            },
            "name": "Engagement Text"
          },
          {
            "type": 1,
            "content": {
              "json": "| Metric                        | Definition                                                         | Question Answered                                                                                         |\r\n|-------------------------------|--------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|\r\n| Active Users                  | Count of users who have performed a user-initiated action          | How many users are interacting with the experience?                                                       |\r\n| Overall Activity              | Proportion of Aware Users who are also Active Users                    | Are users progressing from interested to interacting with the experience?                                 |\r\n| Features Per Session          | Median number of features used per user per session                | Activity depth - how many features are users leveraging each time the user interacts with the experience? |\r\n| Median Features Used Per User | Median number of features used per user                            | Activity breadth - how many features of the experience is a user leveraging?                              |\r\n| Intensity (DAU / MAU)         | Proportion of Monthly Active Users who are also Daily Active Users | What percent of users in a given month interact with the experience on a daily basis?                            |\r\n| Intensity (DAU / WAU)         | Proportion of Weekly Active Users who are also Daily Active Users  | What percent of users in a given week interact with the experience on a daily basis?                             |\r\n\r\n---"
            },
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Engagement"
            },
            "name": "Engagement Metric Definitions"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Engagement"
      },
      "name": "Engagement Overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Retention Overview",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Retention\r\n### Defining Retention\r\nA Retained User is an Active User who was active both this reporting period and the previous reporting period. As Active Users must have at least one telemetry event with an actionType, ** Retention metrics require the [Click Analytics plugin for Application Insights](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin) implemented in the application**."
            },
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Retention"
            },
            "name": "Retention Text"
          },
          {
            "type": 1,
            "content": {
              "json": "| Metric         | Definition                                                                          | Question Answered                                              |\r\n|----------------|-------------------------------------------------------------------------------------|----------------------------------------------------------------|\r\n| Retained Users | Count of Active Users who were also Active the previous period                      | How many users are staying engaged with the experience?        |\r\n| Retention      | Proportion of Active Users from the previous period who are also Active this period | What percent of users are staying engaged with the experience? |\r\n\r\n---"
            },
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Retention"
            },
            "name": "Retention Metric Definitions"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Retention"
      },
      "name": "Retention Overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Happiness\r\n### Defining Happiness\t\r\nHappiness is a user-reported dimension that measures how users feel about the experience offered to them. \r\n\r\n### Measuring Happiness\r\nA common approach to measure this dimension is to ask users a Net Promoter Score (NPS) question such as “Would you recommend this experience to a co-worker?”. Users' responses on a 3 or a 5-point scale (e.g., no, maybe and yes) are aggregated to create an experience-level score ranging from 1-5 (with 5 being the highest). As user-initiated feedback tends to be negatively biased, HEART tracks Happiness from surveys displayed to users at pre-defined intervals.\r\n\r\n### User Sentiment Data\r\nRefer to the [Azure Monitor documentation regarding custom sources](https://docs.microsoft.com/en-us/azure/azure-monitor/agents/data-sources#custom-sources) to upload user sentiment data to calculate Happiness metrics. Common Happiness metrics include \"Average Star Rating\", \"Net Promoter Score\", etc.\r\n\r\n---"
            },
            "name": "text - 5"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Happiness"
      },
      "name": "Happiness"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Task Success Overview",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Task Success\r\n### Defining Task Success\r\nMany experiences include structures designed to funnel users through completing a task. Some examples include the following: \r\n* *adding items to a cart* -> *purchasing items from the cart*\r\n* *searching a keyword* -> *clicking on a result*\r\n* *initiating a new account* -> *completing account registration* \r\n\r\nTask Success tracks whether users can perform a task efficiently and effectively using the capabilities provided by the experience. \r\n\r\n### Measuring Task Success\r\nA successful task meets 3 requirements:\r\n1.\tExpected Task Flow – the intended task flow of the feature was completed (the task flow of the user aligned with the expected task flow)\r\n2.\tHigh Performance – the intended functionality of the feature was accomplished in a reasonable amount of time\r\n3.\tHigh Reliability – the intended functionality of the feature was accomplished without failure\r\n\r\nA task is considered unsuccessful if any of the above requirements is not met. **Task Success metrics require the [Click Analytics plugin for Application Insights](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin) implemented in the application**.\r\n\r\n### Creating a task\r\nSet up a custom task using the below parameters.\r\n\r\n| Parameter         | Description                                                                                                                                                                                                                         |\r\n|-------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\r\n| First Step           | The feature that initiates the task. Using the cart/purchase example above, \"adding items to a cart\" would be the First Step.                                                                                                          |\r\n| Expected Task Duration | The time window to consider a completed task a success. Any tasks completed outside of this constraint is considered a failure. Not all tasks necessarily have a time constraint: for such tasks, select \"No Time Expectation\". |\r\n| Last Step        | The feature that completes the task. Using the cart/purchase example above, \"purchasing items from the cart\" would be the Last Step.                                                                                               |"
            },
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Task Success"
            },
            "name": "Task Success Overview"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Task Success"
      },
      "name": "Task Success Overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Feature Metrics Overview",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Feature Metrics\r\n\r\n### Why Feature Metrics?\r\nFeature Metrics allow for product owners to drill-down into the HEART Metrics to better understand trends. Feature Metrics allow product owners to understand the impact features have on the product on a more granular level than the experience-level metrics. This increased granularity helps identify Retention drivers and areas for improvement, streamlining product development.\r\n\r\n### Measuring Feature Metrics\r\nAs Active Users must have at least one telemetry event with an actionType, **Feature metrics require the [Click Analytics plugin for Application Insights](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin) implemented in the application**.\r\n\r\n### Defining Feature Metrics\r\nThe HEART Framework considers a specific capability of an experience as a *feature*. This workbook identifies features with the *parentId* attribute within the Click Analytics plugin. Some examples of features include the following:\r\n* *a favorite button on a social media post*\r\n* *a search box within a website*\r\n* *a refresh button in a browser* \r\n\r\n\r\n| Metric                   | Definition                                                                                                            | Question Answered                                           |\r\n|--------------------------|-----------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|\r\n| Net New Active Users (Feature)  | Count of users who have interacted with the feature for the first time                                                        | How quickly is this feature gaining new users?               |\r\n| Feature Active Users     | Count of users who have performed a user-initiated action on a specific feature                                       | How many users are actively using this feature?             |\r\n| Interactions             | Median number of user-initiated actions on a specific feature over a time period                                      | How deep is the usage for this feature?                |\r\n| Retained Users (Feature) | Count of Active Users for this feature who were also Active for this feature the previous period                      | How many users continually interact with this feature?       |\r\n| Retention (Feature)      | Proportion of Active Users for this feature from the previous period who are also Active for this feature this period | What percent of users continually interact with this feature? |\r\n"
            },
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Feature"
            },
            "name": "Feature Metrics Defintions"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Feature"
      },
      "name": "Feature Metrics Overview"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "8940997a-18f0-4050-927d-913c85c76182",
            "version": "KqlParameterItem/1.0",
            "name": "DateGrain",
            "label": "Date Grain",
            "type": 2,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\r\n\t\"value\": \"{\\\"date_start\\\": \\\"startofmonth(timestamp)\\\", \\\"date_label\\\": \\\"format_datetime(timestamp, \\\\\\\"yyyy-MM\\\\\\\")\\\", \\\"date_name\\\": \\\"\\\\\\\"month\\\\\\\"\\\", \\\"date_l1\\\": \\\"startofmonth(timestamp)\\\",  \\\"date_l1_label\\\": \\\"\\\\\\\"Month\\\\\\\"\\\", \\\"date_l2\\\": \\\"startofday(timestamp)\\\", \\\"date_l2_label\\\": \\\"\\\\\\\"Day\\\\\\\"\\\", \\\"date_l1_label_short\\\": \\\"\\\\\\\"M\\\\\\\"\\\", \\\"date_l2_label_short\\\": \\\"\\\\\\\"D\\\\\\\"\\\", \\\"date_name_short\\\": \\\"\\\\\\\"M\\\\\\\"\\\"}\",\r\n\t\"label\": \"Monthly\",\r\n    \"selected\": true\r\n},\r\n{\r\n\t\"value\": \"{\\\"date_start\\\": \\\"startofweek(timestamp)\\\", \\\"date_label\\\": \\\"startofweek(timestamp)\\\", \\\"date_name\\\": \\\"\\\\\\\"week\\\\\\\"\\\", \\\"date_l1\\\": \\\"startofmonth(timestamp)\\\", \\\"date_l1_label\\\": \\\"\\\\\\\"Month\\\\\\\"\\\", \\\"date_l2\\\": \\\"startofweek(timestamp)\\\", \\\"date_l2_label\\\": \\\"\\\\\\\"Week\\\\\\\"\\\", \\\"date_l1_label_short\\\": \\\"\\\\\\\"M\\\\\\\"\\\", \\\"date_l2_label_short\\\": \\\"\\\\\\\"W\\\\\\\"\\\", \\\"date_name_short\\\": \\\"\\\\\\\"W\\\\\\\"\\\"}\",\r\n\t\"label\": \"Weekly\",\r\n    \"selected\": false\r\n},\r\n{\r\n\t\"value\": \"{\\\"date_start\\\": \\\"startofday(timestamp)\\\", \\\"date_label\\\": \\\"startofday(timestamp)\\\", \\\"date_name\\\": \\\"\\\\\\\"day\\\\\\\"\\\", \\\"date_l1\\\": \\\"startofweek(timestamp)\\\", \\\"date_l1_label\\\": \\\"\\\\\\\"Week\\\\\\\"\\\", \\\"date_l2\\\": \\\"startofday(timestamp)\\\", \\\"date_l2_label\\\": \\\"\\\\\\\"Day\\\\\\\"\\\", \\\"date_l1_label_short\\\": \\\"\\\\\\\"W\\\\\\\"\\\", \\\"date_l2_label_short\\\": \\\"\\\\\\\"D\\\\\\\"\\\", \\\"date_name_short\\\": \\\"\\\\\\\"D\\\\\\\"\\\"}\",\r\n\t\"label\": \"Daily\",\r\n    \"selected\": false\r\n}]",
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.insights/components"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "Tab",
          "comparison": "isNotEqualTo",
          "value": "Technical"
        },
        {
          "parameterName": "Tab",
          "comparison": "isNotEqualTo",
          "value": "HEART Overview"
        },
        {
          "parameterName": "Tab",
          "comparison": "isNotEqualTo",
          "value": "Happiness"
        }
      ],
      "name": "Date Grain"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### Adoption: Aware Users\r\nCount of unique users who have visited the experience."
            },
            "customWidth": "33",
            "name": "text - 8"
          },
          {
            "type": 1,
            "content": {
              "json": "### Engagement: Active Users\r\nCount of unique users who have voluntarily interacted with the experience."
            },
            "customWidth": "34",
            "name": "text - 8 - Copy"
          },
          {
            "type": 1,
            "content": {
              "json": "### Retention: Month-over-Month Retained Users\r\nCount of unique users who were active in both the current and previous time periods."
            },
            "customWidth": "33",
            "name": "Retention Title"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union pageViews, customEvents\n| where timestamp >= todatetime(\"{Time:value}\") \n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n| summarize [\"Aware Users\"]=dcountif({ConversionScope}, isnotempty({ConversionScope})) by Month=format_datetime(timestamp, \"yyyy-MM\")\n| order by Month asc",
              "size": 1,
              "aggregation": 5,
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  },
                  "min": 0
                }
              }
            },
            "customWidth": "33",
            "name": "Aware Users",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "customEvents\n| where timestamp >= todatetime(\"{Time:value}\")\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n| summarize [\"Active Users\"]=dcountif({ConversionScope},isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})) by Month=format_datetime(timestamp, \"yyyy-MM\")\n| order by Month asc",
              "size": 1,
              "aggregation": 5,
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  },
                  "min": 0
                }
              }
            },
            "customWidth": "34",
            "showPin": false,
            "name": "Active Users",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let datedata = customEvents\n| where timestamp >= todatetime(\"{Time:value}\")\n;\nlet data = customEvents\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n;\nlet ActiveUsersLastMonth = data\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\n| summarize by Month = endofmonth(datetime_add(\"month\", 1, timestamp)), ActiveUser = {ConversionScope}\n;\nlet Retained = data\n| summarize by Month = endofmonth(timestamp), ActiveUser = {ConversionScope}\n| join kind = inner (ActiveUsersLastMonth) on Month, ActiveUser\n| summarize RetainedUsers=dcount(ActiveUser) by Month=format_datetime(Month, \"yyyy-MM\")\n;\ndatedata\n| summarize by Month = format_datetime(timestamp, \"yyyy-MM\")\n| join kind=leftouter (Retained) on Month\n| project Month, [\"Retained Users\"]=coalesce(RetainedUsers, 0)\n| order by Month asc",
              "size": 1,
              "aggregation": 5,
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  },
                  "min": 0
                }
              }
            },
            "customWidth": "33",
            "showPin": false,
            "name": "Retained Users",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "HEART Overview"
      },
      "name": "HEART Overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union pageViews, customEvents\n| where timestamp >= todatetime(\"{Time}\")\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n| summarize [\"Aware Users\"]=dcountif({ConversionScope}, isnotempty({ConversionScope})) by DateLabel={DateGrain:$.date_label}\n| order by DateLabel asc",
              "size": 1,
              "aggregation": 5,
              "title": "Aware Users",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "showPin": false,
            "name": "Aware Users",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let data = union pageViews, customEvents\n| where timestamp >= todatetime(\"{Time}\")\n| extend DateLabel={DateGrain:$.date_label}\n;\nlet userdata = data\n| where isnotempty({ConversionScope})\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n;\nlet userFirstAware = userdata\n| summarize FirstAware=min({DateGrain:$.date_label}) by cs={ConversionScope}\n| summarize NewUsers = dcount(cs) by FirstAware // first date each user visited the experience\n;\nlet userAware = userdata\n| summarize AwareUsers =  dcount({ConversionScope}) by DateLabel\n;\ndata\n| summarize by DateLabel\n| join kind=leftouter (userFirstAware) on $left.DateLabel==$right.FirstAware\n| join kind=leftouter (userAware) on DateLabel\n| summarize [\"Net New Aware Users\"] = max(coalesce(NewUsers, 0)),  [\"Net New Aware Users %\"] = max(coalesce(NewUsers * 1.0 / AwareUsers, 0.0)) by DateLabel\n| order by DateLabel asc",
              "size": 1,
              "aggregation": 5,
              "title": "Net New Aware Users",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "yAxis": [
                  "Net New Aware Users"
                ],
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true
              }
            },
            "customWidth": "50",
            "showPin": false,
            "name": "Net New Aware",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"9fa9cdb1-e41f-413a-a44e-7b2d2f5a3095\",\"mergeType\":\"table\",\"leftTable\":\"Net New Aware\"}],\"projectRename\":[{\"originalName\":\"[Net New Aware].DateLabel\",\"mergedName\":\"DateLabel\",\"fromId\":\"9fa9cdb1-e41f-413a-a44e-7b2d2f5a3095\"},{\"originalName\":\"[Net New Aware].Net New Aware Users %\",\"mergedName\":\"Net New Aware Users %\",\"fromId\":\"9fa9cdb1-e41f-413a-a44e-7b2d2f5a3095\"},{\"originalName\":\"[Net New Aware].Net New Aware Users\"}]}",
              "size": 1,
              "aggregation": 5,
              "title": "Net New Aware Users %",
              "queryType": 7,
              "visualization": "linechart",
              "chartSettings": {
                "xAxis": "DateLabel",
                "yAxis": [
                  "Net New Aware Users %"
                ],
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "percent",
                      "useGrouping": true,
                      "minimumSignificantDigits": 3,
                      "maximumSignificantDigits": 3
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "name": "Net New Aware Users Pct",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let data = union pageViews, customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n;\r\nlet userFirstAware = data\r\n| where isnotempty({ConversionScope})\r\n| summarize DateLabel=min({DateGrain:$.date_label}) by {ConversionScope}, Row=1 // first date each user visited the experience\r\n;\r\ndata\r\n| summarize by DateLabel={DateGrain:$.date_label}\r\n| join kind=leftouter (userFirstAware) on DateLabel\r\n| order by DateLabel asc\r\n| extend RowNum=row_cumsum(Row) // sum rows to count users, 1 row for each user\r\n| summarize [\"Cumulative Aware Users\"]=coalesce(max(RowNum), 0) by DateLabel",
              "size": 1,
              "aggregation": 5,
              "title": "Cumulative Aware Users",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "sortBy": [],
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true
              }
            },
            "customWidth": "50",
            "name": "Cumulative Aware Users",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Adoption"
      },
      "name": "Adoption Metrics"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "customEvents\n| where timestamp >= todatetime(\"{Time}\")\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n| summarize [\"Active Users\"]=dcountif({ConversionScope},isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})) by DateLabel={DateGrain:$.date_label}\n| order by DateLabel asc",
              "size": 1,
              "aggregation": 5,
              "title": "Active Users",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "33",
            "showPin": false,
            "name": "Active Users",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let data = union pageViews, customEvents\n| where timestamp >= todatetime(\"{Time}\")\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n| extend DateLabel={DateGrain:$.date_label}\n;\nlet Activity = data\n| where isnotempty({ConversionScope}) // filter to only authenticated users\n| summarize OverallActivity=dcountif({ConversionScope},isnotnull(customDimensions.actionType)) * 1.0 / dcount({ConversionScope}) by DateLabel \n;\ndata\n| summarize by DateLabel\n| join kind=leftouter (Activity) on DateLabel\n| project DateLabel, [\"Overall Activity\"] = coalesce(OverallActivity, 0.0)\n| order by DateLabel asc",
              "size": 1,
              "aggregation": 5,
              "title": "Overall Activity",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "percent",
                      "useGrouping": true,
                      "minimumSignificantDigits": 3,
                      "maximumSignificantDigits": 3
                    }
                  }
                }
              }
            },
            "customWidth": "34",
            "showPin": false,
            "name": "Overall Activity",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let data = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n| extend DateLabel={DateGrain:$.date_label}\r\n;\r\nlet FeatureSession = data\r\n| where isnotnull(customDimensions.parentId) and isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\r\n| summarize FeatureCount=dcount(tostring(customDimensions.parentId)) by DateLabel, {ConversionScope}, session_Id\r\n| summarize MedianFeaturesSession = percentile(FeatureCount, 50) by DateLabel\r\n;\r\ndata\r\n| summarize by DateLabel\r\n| join kind=leftouter (FeatureSession) on DateLabel\r\n| project DateLabel, [\"Features per Session\"]=coalesce(MedianFeaturesSession, 0)\r\n| order by DateLabel asc",
              "size": 1,
              "aggregation": 5,
              "title": "Activity Depth: Median Features per Session",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "yAxis": [
                  "Features per Session"
                ],
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true
              }
            },
            "customWidth": "33",
            "name": "Median Features per Session",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let data = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n| extend L1 = {DateGrain:$.date_l1}, L2 = {DateGrain:$.date_l2}, Feature=tostring(customDimensions.parentId)\r\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\r\n;\r\nlet L2Feature = data\r\n| summarize L2Features = dcount(Feature) by L1, L2, {ConversionScope}\r\n| summarize L2Median = percentile(L2Features, 50) by L1\r\n;\r\nlet L1Feature = data\r\n| summarize L1Features = dcount(Feature) by L1, {ConversionScope}\r\n| summarize L1Median = percentile(L1Features, 50) by L1\r\n;\r\nL1Feature\r\n| join L2Feature on L1\r\n| extend timestamp=L1\r\n| project DateLabel={DateGrain:$.date_label}, [\"Features Used (\"{DateGrain:$.date_l2_label}\")\"]=L2Median, [\"Features Used (\"{DateGrain:$.date_l1_label}\")\"]=L1Median\r\n| order by DateLabel asc",
              "size": 1,
              "aggregation": 5,
              "title": "Activity Breadth: Median Features Used Per User",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "xAxis": "DateLabel",
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  },
                  "min": 0
                }
              }
            },
            "customWidth": "33",
            "name": "Median Features Used",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let datedata = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n| extend L1 = {DateGrain:$.date_l1}, L2 = {DateGrain:$.date_l2}\r\n;\r\nlet data = datedata\r\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n;\r\nlet l2au = data\r\n| summarize L2ActiveUsers = dcount({ConversionScope}) by L1, L2\r\n;\r\nlet l1au = data\r\n| summarize L1ActiveUsers = dcount({ConversionScope}) by L1\r\n;\r\ndatedata\r\n| summarize by L1\r\n| join kind=leftouter (l2au) on L1\r\n| join kind=leftouter (l1au) on L1\r\n| extend timestamp=L1\r\n| summarize [\"Intensity (\"{DateGrain:$.date_l2_label_short}\"AU / \"{DateGrain:$.date_l1_label_short}\"AU)\"] = percentile(L2ActiveUsers, 50) * 1.0 / min(L1ActiveUsers) by DateLabel={DateGrain:$.date_label}\r\n| order by DateLabel asc",
              "size": 1,
              "aggregation": 5,
              "title": "Activity Frequency: Intensity",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "month",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Intensity",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "xAxis": "DateLabel",
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "percent",
                      "minimumSignificantDigits": 3,
                      "maximumSignificantDigits": 3
                    }
                  }
                }
              }
            },
            "customWidth": "33",
            "name": "Intensity",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Engagement"
      },
      "name": "Engagement Metrics"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let datedata = customEvents\n| where timestamp >= todatetime(\"{Time}\")\n;\nlet data = datedata\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope}) // filter to active authenticated users only\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n;\nlet ActiveUsersLastDate = data\n| extend timestamp = datetime_add({DateGrain:$.date_name}, 1, timestamp)\n| summarize by timestamp = {DateGrain:$.date_start}, ActiveUser = {ConversionScope}\n;\nlet Retained = data\n| summarize by timestamp = {DateGrain:$.date_start}, ActiveUser = {ConversionScope}\n| join kind = inner (ActiveUsersLastDate) on timestamp, ActiveUser\n| summarize RetainedUsers=dcount(ActiveUser) by DateLabel={DateGrain:$.date_label}\n;\ndatedata\n| summarize by DateLabel = {DateGrain:$.date_label}\n| join kind=leftouter (Retained) on DateLabel\n| project DateLabel, [\"\"{DateGrain:$.date_name_short}\"o\"{DateGrain:$.date_name_short}\" Retained Users\"]=coalesce(RetainedUsers, 0)\n| order by DateLabel asc",
              "size": 1,
              "aggregation": 5,
              "title": "Retained Users",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "showPin": false,
            "name": "Retained Users",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let datedata = customEvents\n| where timestamp >= todatetime(\"{Time}\")\n;\nlet data = datedata\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n;\nlet ActiveUsersLastDate = data\n| extend timestamp = datetime_add({DateGrain:$.date_name}, 1, timestamp)\n| summarize by timestamp = {DateGrain:$.date_start}, ActiveUser = {ConversionScope}\n;\nlet Retained = data\n| summarize by timestamp = {DateGrain:$.date_start}, ActiveUser = {ConversionScope}\n| join kind = inner (ActiveUsersLastDate) on timestamp, ActiveUser\n| summarize RetainedUsers=dcount(ActiveUser) by DateLabel={DateGrain:$.date_label}\n;\ndatedata\n| summarize by DateLabel = {DateGrain:$.date_label}\n| join kind=leftouter (Retained) on DateLabel\n| join kind=leftouter (ActiveUsersLastDate | summarize ActiveUsers=dcount(ActiveUser) by DateLabel={DateGrain:$.date_label}) on DateLabel  // count all active users from previous month\n| extend Retention = RetainedUsers * 1.0 / ActiveUsers\n| project DateLabel, [\"\"{DateGrain:$.date_name_short}\"o\"{DateGrain:$.date_name_short}\" Retention\"]=coalesce(case(isnan(Retention), 0.0, Retention), 0.0)\n| order by DateLabel asc",
              "size": 1,
              "aggregation": 5,
              "title": "Retention",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "Month",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Month",
                  "sortOrder": 2
                }
              ],
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "percent",
                      "useGrouping": true,
                      "minimumSignificantDigits": 3,
                      "maximumSignificantDigits": 3
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "showPin": false,
            "name": "Retention",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Retention"
      },
      "name": "Retention Metrics"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Estimating Happiness\r\n\r\n**The most accurate method to measure user satisfaction is prompting users with in-app surveys.** The below visuals only _attempt to estimate changes_ in user satisfaction based on user engagement metrics. The \"Week-over-Week Happiness\" estimates user satisfaction based on week-over-week trends of these metrics. Generally, an increase in one or more of the \"Happiness Drivers\" will likely result in improved user satisfaction, while an increase in one or more of the \"Happiness Detractors\" will likely result in decreased user satisfaction.\r\n\r\n#### Happiness Drivers\r\n\r\nThe below metrics tend improve user satisfaction. While the degree to which these metrics impact satisfaction varies by application, an increase in these metrics often contributes to users feeling more satisfied with the application.\r\n\r\n| Metric                | Definition                                                                        |\r\n|-----------------------|-----------------------------------------------------------------------------------|\r\n| Feature Usage %       | Proportion of features that are used on a monthly basis                           |\r\n| Intensity (DAU / WAU) | Proportion of Weekly Active Users who are also Daily Active Users                |\r\n| WoW Retention %           | Proportion of Active Users from this week who were also Active the previous week |\r\n\r\n#### Happiness Detractors\r\n\r\nThe below metrics tend to have a negative impact on user satisfaction. While the degree to which these metrics impact satisfaction varies by application, an increase in these metrics often contributes to users feeling less satisfied with the application.\r\n\r\n| Metric           | Definition                                                         |\r\n|------------------|--------------------------------------------------------------------|\r\n| Error Rate       | Proportion of events resulting in an error                         |\r\n| Median Load Time | Median load time (in seconds) of all components in the application |\r\n"
            },
            "name": "Happiness Estimation Description"
          },
          {
            "type": 1,
            "content": {
              "json": "### Estimating Week-over-Week Happiness Trends\r\n"
            },
            "name": "Happiness Trend Title"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let truthTable_dt = datatable(v1: long, v2: long, v3: long, v4: long, v5: long) [\r\n0,0,0,0,0, \r\n0,0,0,0,1,\r\n0,0,0,1,0,\r\n0,0,0,1,1,\r\n0,0,1,0,0,\r\n0,0,1,0,1,\r\n0,0,1,1,0,\r\n0,0,1,1,1,\r\n0,1,0,0,0,\r\n0,1,0,0,1,\r\n0,1,0,1,0,\r\n0,1,0,1,1,\r\n0,1,1,0,0,\r\n0,1,1,0,1,\r\n0,1,1,1,0,\r\n0,1,1,1,1,\r\n1,0,0,0,0,\r\n1,0,0,0,1,\r\n1,0,0,1,0,\r\n1,0,0,1,1,\r\n1,0,1,0,0,\r\n1,0,1,0,1,\r\n1,0,1,1,0,\r\n1,0,1,1,1,\r\n1,1,0,0,0,\r\n1,1,0,0,1,\r\n1,1,0,1,0,\r\n1,1,0,1,1,\r\n1,1,1,0,0,\r\n1,1,1,0,1,\r\n1,1,1,1,0,\r\n1,1,1,1,1,\r\n]\r\n;\r\nlet truthTable = truthTable_dt\r\n| extend vImprovers = case(v1 + v2 + v3 > 1, 1, 0)\r\n| extend vDetractors = case(v4 + v5 > 0, 1, 0)\r\n| extend isHappy = case(\r\n    vImprovers > vDetractors, \"Happier\", \r\n    vImprovers < vDetractors, \"Less Happy\",\r\n    vImprovers == vDetractors, \"Similar\",\r\n    \"None\")\r\n| project vConcat = strcat(v1, v2, v3, v4, v5), isHappy\r\n;\r\nlet datedata = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n| extend Month = startofmonth(timestamp), Day = startofday(timestamp), Week = startofweek(timestamp), DateLabel = startofweek(timestamp)\r\n| extend PrevDate = datetime_add(\"week\", 1, DateLabel)\r\n;\r\nlet data = datedata\r\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n;\r\nlet Dau = data\r\n| summarize DActiveUsers = dcount({ConversionScope}) by DateLabel, Day\r\n| summarize DMedian = percentile(DActiveUsers, 50) by DateLabel\r\n;\r\nlet Wau = data\r\n| summarize WActiveUsers = dcount({ConversionScope}) by DateLabel\r\n;\r\nlet ActiveUsersLastDate = data\r\n| extend timestamp = datetime_add(\"day\", 7, timestamp)\r\n| summarize by DateLabel = startofweek(timestamp), ActiveUser = {ConversionScope}\r\n;\r\nlet RetainedUsers = data\r\n| summarize by DateLabel, ActiveUser = {ConversionScope}\r\n| join kind = inner (ActiveUsersLastDate) on DateLabel, ActiveUser\r\n| summarize RetainedUsers=dcount(ActiveUser) by DateLabel\r\n//| summarize RetainedUsers=percentile(RetainedUsers, 50) by DateLabel\r\n;\r\nlet Retained = RetainedUsers\r\n| join kind=inner (Wau) on DateLabel\r\n| summarize Retention = sum(RetainedUsers) * 1.0 / sum(WActiveUsers) by DateLabel\r\n;\r\nlet FeatureCount = data\r\n| summarize Features = dcount(tostring(customDimensions.parentId)) by One=1\r\n;\r\nlet Feature = data\r\n| summarize Features = dcount(tostring(customDimensions.parentId)) by DateLabel, {ConversionScope}\r\n| summarize MedianFeature = percentile(Features, 50), One=1 by DateLabel\r\n| join kind=inner (FeatureCount) on One\r\n| project MedianFeature = MedianFeature * 1.0 / Features, DateLabel\r\n;\r\nlet MedLoadTime = dependencies\r\n| summarize MedianLoadTime=percentile(duration * 0.001, 50) by DateLabel = startofweek(timestamp)\r\n;\r\nlet ErrorRate = dependencies\r\n| summarize Fails=countif(success==\"False\"), Total=count() by DateLabel = startofweek(timestamp)\r\n| project DateLabel, FailRate=coalesce(Fails * 1.0/Total, 0.0)\r\n;\r\nlet aggdata = data\r\n| summarize by  DateLabel, PrevDate\r\n| join kind=leftouter (Dau) on DateLabel\r\n| join kind=leftouter (Wau) on DateLabel\r\n//| join kind=leftouter (ActiveUsersLastDate | summarize LastActiveUsers=dcount(ActiveUser) by DateLabel=format_datetime(timestamp, \"yyyy-MM\")) on DateLabel\r\n| join kind=leftouter (Retained) on DateLabel\r\n| join kind=leftouter (Feature) on DateLabel\r\n| join kind=leftouter (MedLoadTime) on DateLabel\r\n| join kind=leftouter (ErrorRate) on DateLabel\r\n| extend Intensity = DMedian *1.0 / WActiveUsers\r\n| project DateLabel, PrevDate, Intensity = coalesce(Intensity, 0.0), FeatureUsage = coalesce(MedianFeature, 0.0), Retention = coalesce(Retention, 0.0), LoadTime = coalesce(MedianLoadTime, 0.0), ErrorRate=coalesce(FailRate, 0.0) \r\n;\r\nlet cleanedAggdata = aggdata\r\n| join kind=leftouter (aggdata) on $left.DateLabel == $right.PrevDate\r\n| extend v1 = case(Intensity >= Intensity1, 1, 0),  v2 = case(FeatureUsage >=FeatureUsage1, 1, 0),  v3 = case(Retention >= Retention1, 1, 0), v4 = case(LoadTime >= LoadTime1, 1, 0), v5 = case(ErrorRate >= ErrorRate1, 1, 0)\r\n| project DateLabel, [\"Intensity (DAU/WAU)\"] = Intensity, [\"Feature Usage %\"] = FeatureUsage, [\"WoW Retention %\"] = Retention, [\"Median Load Time (s)\"] = LoadTime, [\"Error Rate\"] = ErrorRate, vConcat = strcat(v1, v2, v3, v4, v5), PrevDate1\r\n;\r\ncleanedAggdata\r\n| join kind=inner (truthTable) on vConcat\r\n| project Week=DateLabel, [\"Intensity (DAU/WAU)\"], [\"Feature Usage %\"], [\"WoW Retention %\"], [\"Median Load Time (s)\"], [\"Error Rate\"], [\"Week-over-Week Happiness\"]=case(isnull(PrevDate1), \"None\", isHappy)\r\n| order by Week desc",
              "size": 1,
              "aggregation": 5,
              "title": "Estimated Changes in Week-over-Week Happiness",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Intensity (DAU/WAU)",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Feature Usage %",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Retention %",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Median Load Time (s)",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Error Rate",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Week-over-Week Happiness",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Similar",
                          "representation": "gray",
                          "text": "Similar User Satisfaction"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Less Happy",
                          "representation": "yellow",
                          "text": "Likely lower User Satisfaction"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Happier",
                          "representation": "green",
                          "text": "Likely higher User Satisfaction"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "Weekly trends unavailable"
                        }
                      ],
                      "customColumnWidthSetting": "50ch"
                    }
                  },
                  {
                    "columnMatch": "Retention%",
                    "formatter": 5
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "Feature Usage %"
                  },
                  {
                    "columnId": "Median Load Time (s)"
                  },
                  {
                    "columnId": "Error Rate"
                  }
                ]
              },
              "sortBy": [],
              "chartSettings": {
                "xAxis": "DateLabel",
                "yAxis": [
                  "Feature Usage %",
                  "Intensity (DAU/MAU)",
                  "Retention%"
                ],
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "name": "Happiness Data"
          },
          {
            "type": 1,
            "content": {
              "json": "The visuals below show the drivers for Happiness."
            },
            "name": "Happiness Drivers Text"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"c9574b84-e012-46c2-bd84-6ec34133e09e\",\"mergeType\":\"table\",\"leftTable\":\"Happiness Data\"}]}",
              "size": 1,
              "aggregation": 5,
              "title": "Week-over-Week Happiness Drivers",
              "queryType": 7,
              "visualization": "linechart",
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "DateLabel",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "DateLabel",
                  "sortOrder": 1
                }
              ],
              "chartSettings": {
                "xAxis": "Week",
                "yAxis": [
                  "Feature Usage %",
                  "WoW Retention %",
                  "Intensity (DAU/WAU)"
                ],
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "name": "Happiness Drivers",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"75f569a1-989e-4220-a122-54d47ec660bc\",\"mergeType\":\"table\",\"leftTable\":\"Happiness Data\"}]}",
              "size": 1,
              "aggregation": 5,
              "title": "Week-over-Week Happiness Detractors",
              "queryType": 7,
              "visualization": "linechart",
              "chartSettings": {
                "xAxis": "Week",
                "yAxis": [
                  "Error Rate",
                  "Median Load Time (s)"
                ],
                "showDataPoints": true
              }
            },
            "customWidth": "50",
            "name": "Happiness Detractors",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Happiness"
      },
      "name": "Happiness Metrics"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "0926fed8-73b7-445a-9b95-0162a261b7ea",
                  "version": "KqlParameterItem/1.0",
                  "name": "TopStep",
                  "type": 2,
                  "description": "Select the activities that form the top of your funnel.",
                  "isRequired": true,
                  "query": "union customEvents\r\n| where timestamp > ago(90d)\r\n| summarize by Feature=tostring(customDimensions.parentId)\r\n| where isnotempty(Feature)\r\n| order by Feature asc\r\n| project Id=Feature, Title=Feature, Selected=false",
                  "value": "App Name Search",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.insights/components",
                  "label": "First Step"
                },
                {
                  "id": "8011e573-a9c3-420d-93c6-aff9f652234d",
                  "version": "KqlParameterItem/1.0",
                  "name": "ExpDuration",
                  "label": "Expected Task Duration",
                  "type": 2,
                  "description": "Select the expected time frame in which this funnel is expected to be completed.",
                  "isRequired": true,
                  "query": "datatable(text:string, value:timespan, selected:bool)[\r\n\"No Time Expectation\", time(0.00:00:00.0), true,\r\n\"1 second\", time(0.00:00:01.0), false,\r\n\"2 seconds\", time(0.00:00:02.0), false,\r\n\"5 seconds\", time(0.00:00:05.0), false,\r\n\"30 seconds\", time(0.00:00:30.0), false,\r\n\"60 seconds\", time(0.00:01:00.0), false,\r\n\"90 seconds\", time(0.00:01:30.0), false,\r\n\"2 minutes\", time(0.00:02:00.0), false,\r\n\"1 hour\", time(0.01:00:00.0), false,\r\n\"1 day\", time(1.00:00:00.0), false,\r\n]\r\n| order by value asc\r\n| project value, text, selected",
                  "value": "00:00:00",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "defaultValue": "value::1",
                  "queryType": 0,
                  "resourceType": "microsoft.insights/components"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.insights/components"
            },
            "name": "FunnelTop"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "86e6de6d-8983-4327-bf84-fdc6dd7a23c7",
                  "version": "KqlParameterItem/1.0",
                  "name": "BottomStep",
                  "type": 2,
                  "description": "Select the activities that form the bottom of your funnel.",
                  "isRequired": true,
                  "query": "union customEvents\r\n| where timestamp > ago(90d)\r\n| summarize by Feature=tostring(customDimensions.parentId)\r\n| where isnotempty(Feature)\r\n| order by Feature asc\r\n| project Id=Feature, Title=Feature, Selected=false",
                  "value": "Registration Save",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.insights/components",
                  "label": "Last Step"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.insights/components"
            },
            "name": "FunnelBottom"
          },
          {
            "type": 1,
            "content": {
              "json": "#### Task Completion"
            },
            "name": "Task Completion Title"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let data = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n| where isnotempty({ConversionScope});\r\nlet topUsers = data\r\n| where customDimensions.parentId == \"{TopStep}\"\r\n| summarize by timestamp, session_Id, {ConversionScope};\r\nlet bottomUsers = data\r\n| where customDimensions.parentId == \"{BottomStep}\"\r\n| summarize by Step2Timestamp=timestamp, session_Id, {ConversionScope};\r\nlet funnel = topUsers\r\n| join kind=inner (bottomUsers) on session_Id\r\n| where Step2Timestamp >= timestamp\r\n| summarize timestamp=max(timestamp) by Step2Timestamp, session_Id, {ConversionScope};\r\nlet funnelTop = topUsers\r\n| summarize TopCount=count() by DateLabel={DateGrain:$.date_label};\r\nlet funnelBottom = funnel\r\n| extend Duration = Step2Timestamp - timestamp\r\n| extend NoTime = time({ExpDuration}) == 0\r\n| extend Flag = case(NoTime or Duration <= time({ExpDuration}), true, false)\r\n| summarize BottomCount=countif(Flag) by DateLabel={DateGrain:$.date_label};\r\ndata\r\n| summarize by DateLabel={DateGrain:$.date_label}\r\n| join kind=leftouter (funnelTop) on DateLabel\r\n| join kind=leftouter (funnelBottom) on DateLabel\r\n| project DateLabel, [\"Task Completion Rate\"]=coalesce(BottomCount * 1.0 / TopCount, 0.0)\r\n| order by DateLabel asc",
              "size": 1,
              "aggregation": 5,
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "xAxis": "DateLabel",
                "yAxis": [
                  "Task Completion Rate"
                ],
                "group": null,
                "createOtherGroup": 0,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "percent",
                      "useGrouping": true,
                      "minimumSignificantDigits": 3,
                      "maximumSignificantDigits": 3
                    }
                  }
                }
              }
            },
            "name": "Task Completion"
          },
          {
            "type": 1,
            "content": {
              "json": "#### Duration\r\nAnalyze the duration between the selected First Step and Last Step below. Adjust the percentile parameters to change the percentiles shown in the visual. This visual helps understand the time distribution against a specified task. As an example, a percentile of 75 means that 75% of tasks are completed within this time range (and therefore 25% of tasks are *not* completed within this time range)."
            },
            "name": "Duration Overview"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "6df5688d-ec30-4831-a7a6-6dc35fff05a3",
                  "version": "KqlParameterItem/1.0",
                  "name": "DurationUnits",
                  "label": "Duration Units",
                  "type": 2,
                  "description": "Select the units for which Duration will be displayed.",
                  "isRequired": true,
                  "query": "let Table=datatable(value:timespan, text:string, selected:bool)[\r\n1s, 'Seconds', true,\r\n1m, 'Minutes', false,\r\n1h, 'Hours', false,\r\n1d, 'Days', false,\r\n];\r\nTable\r\n| project value, text, selected",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.insights/components"
                },
                {
                  "id": "b81fcce1-8eab-4d6b-afec-98d417cf6f83",
                  "version": "KqlParameterItem/1.0",
                  "name": "Duration1",
                  "label": "Duration Percentile 1",
                  "type": 1,
                  "description": "Select the first percentile to be shown in the Duration visual.",
                  "isRequired": true,
                  "query": "datatable(perc: int)[\r\n25,\r\n]",
                  "queryType": 0,
                  "resourceType": "microsoft.insights/components"
                },
                {
                  "id": "270ce462-f916-4f80-8fc6-f8c4aaaf9242",
                  "version": "KqlParameterItem/1.0",
                  "name": "Duration2",
                  "label": "Duration Percentile 2",
                  "type": 1,
                  "description": "Select the second percentile to be shown in the Duration visual.",
                  "isRequired": true,
                  "query": "datatable(perc: int)[\r\n50,\r\n]",
                  "queryType": 0,
                  "resourceType": "microsoft.insights/components"
                },
                {
                  "id": "94d743c9-056f-4401-a1c2-8c62c9113b80",
                  "version": "KqlParameterItem/1.0",
                  "name": "Duration3",
                  "label": "Duration Percentile 3",
                  "type": 1,
                  "description": "Select the third percentile to be shown in the Duration visual.",
                  "isRequired": true,
                  "query": "datatable(perc: int)[\r\n75,\r\n]",
                  "queryType": 0,
                  "resourceType": "microsoft.insights/components"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.insights/components"
            },
            "name": "Duration Parameters"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let data = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n| where isnotempty({ConversionScope});\r\nlet topUsers = data\r\n| where customDimensions.parentId == \"{TopStep}\"\r\n| summarize by timestamp, session_Id, {ConversionScope};\r\nlet bottomUsers = data\r\n| where customDimensions.parentId == \"{BottomStep}\"\r\n| summarize by Step2Timestamp=timestamp, session_Id, {ConversionScope};\r\nlet funnel = topUsers\r\n| join kind=inner (bottomUsers) on session_Id\r\n| where Step2Timestamp >= timestamp\r\n| summarize timestamp=max(timestamp) by Step2Timestamp, session_Id, {ConversionScope};\r\nlet funnelTop = topUsers\r\n| summarize TopCount=count() by DateLabel={DateGrain:$.date_label};\r\nlet funnelDuration = funnel\r\n| extend DateLabel={DateGrain:$.date_label}, Duration=(Step2Timestamp-timestamp)/time({DurationUnits})\r\n| summarize Duration1 = percentile(Duration, {Duration1}), Duration2 = percentile(Duration, {Duration2}), Duration3 = percentile(Duration, {Duration3}) by DateLabel;\r\nlet funnelBottom = funnel\r\n| summarize BottomCount=count() by DateLabel={DateGrain:$.date_label};\r\ndata\r\n| summarize by DateLabel={DateGrain:$.date_label}\r\n| join kind=leftouter (funnelDuration) on DateLabel\r\n| project DateLabel, [\"Duration 1\"] = Duration1, [\"Duration 2\"] = Duration2, [\"Duration 3\"] = Duration3\r\n| order by DateLabel asc",
              "size": 1,
              "aggregation": 5,
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "xAxis": "DateLabel",
                "yAxis": [
                  "Duration 1",
                  "Duration 2",
                  "Duration 3"
                ],
                "group": null,
                "createOtherGroup": 0
              }
            },
            "name": "Duration"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Task Success"
      },
      "name": "Task Success Metrics"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "---"
            },
            "name": "Feature Top Line Separator"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "445ab212-5be3-4534-9bb1-a2152c602b64",
                  "version": "KqlParameterItem/1.0",
                  "name": "Feature",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "customEvents\r\n| extend Feature = tostring(customDimensions.parentId)\r\n| where isnotempty(Feature)\r\n| distinct Feature",
                  "value": [
                    "App Name Search"
                  ],
                  "typeSettings": {
                    "limitSelectTo": 5,
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "defaultValue": "value::1",
                  "queryType": 0,
                  "resourceType": "microsoft.insights/components"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.insights/components"
            },
            "name": "Feature Parameter"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let datedata = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n| extend DateLabel={DateGrain:$.date_label}\r\n;\r\nlet data = datedata\r\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope}) and tostring(customDimensions.parentId) in ({Feature})\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n;\r\nlet FeatureAU = data\r\n| summarize ActiveUsers = dcount({ConversionScope}) by DateLabel\r\n;\r\ndatedata\r\n| summarize by DateLabel\r\n| join kind=leftouter (FeatureAU) on DateLabel\r\n| project DateLabel, [\"Active Users\"]=coalesce(ActiveUsers, 0)\r\n| order by DateLabel asc",
                    "size": 1,
                    "aggregation": 5,
                    "title": "Active Users (Feature)",
                    "queryType": 0,
                    "resourceType": "microsoft.insights/components",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "linechart",
                    "chartSettings": {
                      "xAxis": "DateLabel",
                      "yAxis": [
                        "Active Users"
                      ],
                      "group": null,
                      "createOtherGroup": 0,
                      "showDataPoints": true
                    }
                  },
                  "customWidth": "33",
                  "name": "Active Users (Feature)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let datedata = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n;\r\nlet userFirstAware = datedata\r\n| where isnotempty({ConversionScope}) and tostring(customDimensions.parentId) in ({Feature})\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n| summarize timestamp=min(timestamp) by {ConversionScope}\r\n| project {ConversionScope}, DateLabel={DateGrain:$.date_label}\r\n;\r\ndatedata\r\n| summarize by DateLabel={DateGrain:$.date_label}\r\n| join kind=leftouter (userFirstAware) on DateLabel\r\n| summarize [\"Net New Active Users\"]=coalesce(dcount({ConversionScope}), 0) by DateLabel\r\n| order by DateLabel asc",
                    "size": 1,
                    "aggregation": 5,
                    "title": "Net New Active Users (Feature)",
                    "queryType": 0,
                    "resourceType": "microsoft.insights/components",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "linechart",
                    "chartSettings": {
                      "xAxis": "DateLabel",
                      "yAxis": [
                        "Net New Active Users"
                      ],
                      "group": null,
                      "createOtherGroup": 0,
                      "showDataPoints": true
                    }
                  },
                  "customWidth": "34",
                  "name": "Net New Users (Feature)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let datedata = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n| extend DateLabel={DateGrain:$.date_label}\r\n;\r\nlet data = datedata\r\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope}) and tostring(customDimensions.parentId) in ({Feature})\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n;\r\nlet FeatureInteractions = data\r\n| summarize Interactions=count() by DateLabel, {ConversionScope}\r\n| summarize MedianInteractions = percentile(Interactions, 50) by DateLabel\r\n;\r\ndatedata\r\n| summarize by DateLabel\r\n| join kind=leftouter (FeatureInteractions) on DateLabel\r\n| project DateLabel, [\"Median Interactions\"]=coalesce(MedianInteractions, 0)\r\n| order by DateLabel asc",
                    "size": 1,
                    "aggregation": 5,
                    "title": "Median Interactions per User",
                    "queryType": 0,
                    "resourceType": "microsoft.insights/components",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "linechart",
                    "chartSettings": {
                      "xAxis": "DateLabel",
                      "yAxis": [
                        "Median Interactions"
                      ],
                      "group": null,
                      "createOtherGroup": 0,
                      "showDataPoints": true
                    }
                  },
                  "customWidth": "33",
                  "name": "Median Interactions",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let datedata = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n;\r\nlet data = datedata\r\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope}) and tostring(customDimensions.parentId) in ({Feature})\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n;\r\nlet ActiveUsersLastDate = data\r\n| extend timestamp = datetime_add({DateGrain:$.date_name}, 1, timestamp)\r\n| summarize by timestamp = {DateGrain:$.date_start}, ActiveUser = {ConversionScope}\r\n;\r\nlet Retained = data\r\n| summarize by timestamp = {DateGrain:$.date_start}, ActiveUser = {ConversionScope}\r\n| join kind = inner (ActiveUsersLastDate) on timestamp, ActiveUser\r\n| summarize RetainedUsers=dcount(ActiveUser) by DateLabel={DateGrain:$.date_label}\r\n;\r\ndatedata\r\n| summarize by DateLabel={DateGrain:$.date_label}\r\n| join kind=leftouter (Retained) on DateLabel\r\n| project DateLabel, [\"\"{DateGrain:$.date_name_short}\"o\"{DateGrain:$.date_name_short}\" Retained Users\"]=coalesce(RetainedUsers, 0)\r\n| order by DateLabel asc",
                    "size": 1,
                    "aggregation": 5,
                    "title": "Retained Users (Feature)",
                    "queryType": 0,
                    "resourceType": "microsoft.insights/components",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "linechart",
                    "chartSettings": {
                      "xAxis": "DateLabel",
                      "group": null,
                      "createOtherGroup": 0,
                      "showDataPoints": true
                    }
                  },
                  "customWidth": "33",
                  "name": "Retained Users (Feature)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let datedata = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n;\r\nlet data = datedata\r\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope}) and tostring(customDimensions.parentId) in ({Feature})\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n;\r\nlet ActiveUsersLastDate = data\r\n| extend timestamp = datetime_add({DateGrain:$.date_name}, 1, timestamp)\r\n| summarize by timestamp = {DateGrain:$.date_start}, ActiveUser = {ConversionScope}\r\n;\r\nlet Retained = data\r\n| summarize by timestamp = {DateGrain:$.date_start}, ActiveUser = {ConversionScope}\r\n| join kind = inner (ActiveUsersLastDate) on timestamp, ActiveUser\r\n| summarize RetainedUsers=dcount(ActiveUser) by DateLabel={DateGrain:$.date_label}\r\n;\r\ndatedata\r\n| summarize by DateLabel={DateGrain:$.date_label}\r\n| join kind=leftouter (Retained) on DateLabel\r\n| join kind=leftouter (ActiveUsersLastDate | summarize ActiveUsers=dcount(ActiveUser) by DateLabel={DateGrain:$.date_label}) on DateLabel\r\n| extend Retention = RetainedUsers * 1.0 / ActiveUsers\r\n| project DateLabel, [\"\"{DateGrain:$.date_name_short}\"o\"{DateGrain:$.date_name_short}\" Retention\"]=coalesce(case(isnan(Retention), 0.0, Retention), 0.0)\r\n| order by DateLabel asc",
                    "size": 1,
                    "aggregation": 5,
                    "title": "Retention (Feature)",
                    "queryType": 0,
                    "resourceType": "microsoft.insights/components",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "linechart",
                    "chartSettings": {
                      "xAxis": "DateLabel",
                      "group": null,
                      "createOtherGroup": 0,
                      "showDataPoints": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 0,
                          "options": {
                            "style": "percent",
                            "useGrouping": true,
                            "minimumSignificantDigits": 3,
                            "maximumSignificantDigits": 3
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "34",
                  "name": "Retention (Feature)",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "name": "Feature Metrics"
          },
          {
            "type": 1,
            "content": {
              "json": "---"
            },
            "name": "Feature Section Separator"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Feature"
      },
      "name": "Feature Metrics"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let datedata = customEvents\r\n| where timestamp >= todatetime(\"{Time:value}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n    and isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\r\n| extend L1 = {DateGrain:$.date_l1}, L2 = {DateGrain:$.date_l2}, Feature=tostring(customDimensions.parentId)\r\n;\r\nlet L2ActiveUsers = datedata\r\n| summarize L2Users = dcount({ConversionScope}) by L1, L2, Feature\r\n| summarize L2AU = percentile(L2Users, 50) by Feature\r\n;\r\nlet L1ActiveUsers = datedata\r\n| summarize L1Users = dcount({ConversionScope}) by L1, Feature\r\n| summarize L1AU = percentile(L1Users, 50) by Feature\r\n;\r\ndatedata\r\n| summarize ActiveUsers = dcount({ConversionScope}) by Feature\r\n| join (L2ActiveUsers) on Feature\r\n| join (L1ActiveUsers) on Feature\r\n| extend Intensity = L2AU * 1.0 / L1AU\r\n| summarize by Feature, [\"Active Users\"]=ActiveUsers, [\"\"{DateGrain:$.date_l2_label_short}\"AU\"] = L2AU,  [\"\"{DateGrain:$.date_l1_label_short}\"AU\"]=L1AU, Intensity=coalesce(Intensity, 0.0)\r\n| order by [\"Active Users\"] desc",
        "size": 0,
        "title": "Users by Feature",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "crossComponentResources": [
          "{Resource}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Active Users",
              "formatter": 3,
              "formatOptions": {
                "palette": "blue",
                "customColumnWidthSetting": "18ch"
              }
            },
            {
              "columnMatch": "DAU",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "10ch"
              }
            },
            {
              "columnMatch": "MAU",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "10ch"
              }
            },
            {
              "columnMatch": "Intensity",
              "formatter": 0,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "percent",
                  "minimumSignificantDigits": 3,
                  "maximumSignificantDigits": 3
                }
              }
            }
          ],
          "rowLimit": 100
        },
        "sortBy": []
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Feature"
      },
      "customWidth": "100",
      "name": "Users by Feature",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Telemetry Requirements",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Click Analytics for Application Insights\r\nThe HEART Framework uses the [Click Analytics plugin for Application Insights](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin). To calculate HEART Metrics, the **[Click Analytics plugin for Application Insights](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin) must be implemented in the application**."
                  },
                  "name": "text - 12"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Data Dictionary\r\nThe required attributes to calculate HEART metrics are listed below."
                  },
                  "name": "Data Dictionary Title"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "| Source          | Attribute            | Description                                |\r\n|-----------------|----------------------|--------------------------------------------|\r\n| customEvents    | user_AuthenticatedId | unique authenticated user identifier       |\r\n| customEvents    | session_Id           | unique session identifier                  |\r\n| customEvents    | appName              | unique Application Insights app identifier |\r\n| customEvents    | itemType             | category of customEvents record            |\r\n| customEvents    | timestamp            | datetime of event                          |\r\n| customEvents    | operation_Id         | correlate telemetry events                 |\r\n| customEvents    | user_Id         \t | unique user identifier                 \t  |\r\n| customEvents*   | parentId             | name of feature                            |\r\n| customEvents*   | pageName             | name of page                               |\r\n| customEvents*   | actionType           | category of Click Analytics record         |\r\n| pageViews       | user_AuthenticatedId | unique authenticated user identifier       |\r\n| pageViews       | session_Id           | unique session identifier                  |\r\n| pageViews       | appName              | unique Application Insights app identifier |\r\n| pageViews       | timestamp            | datetime of event                          |\r\n| pageViews       | operation_Id         | correlate telemetry events                 |\r\n| pageViews       | user_Id         \t | unique user identifier                     |\r\n\r\n*The [Click Analytics plugin](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin) must be implemented to emit these attributes."
                  },
                  "name": "customEvents Data Dictionary"
                }
              ]
            },
            "name": "Telemetry Requirements"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Telemetry Warnings",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Telemetry Warnings\r\nCommon data discrepancies, along with their suggestion resolutions, are listed below."
                  },
                  "name": "Telemetry Warnings Title"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WarningCodes = datatable (Code:long, Warning:string, Resolution:string)\r\n    [0, \"No Warning\", \"None\",\r\n     1, \"⚠️ No user rows found in selected time period.\", \"Ensure telemetry is emitting user rows in the selected time period.\",\r\n     2, \"⚠️ Multiple users found in the same session.\", \"Check if telemetry is creating sessions without creating a {ConversionScope}.\",\r\n     3, \"️️️⚠️ Row(s) in customEvents with actionType value but no {ConversionScope}\", \"At least one click has been emitted without a {ConversionScope}. Check if telemetry is creating sessions without establishing a {ConversionScope}.\",\r\n     4, \"⚠️ Row(s) in customEvents with {ConversionScope} but no actionType value.\", \"Visit the Click Analytics documentation for more information about its implementation.\",\r\n     5, \"⚠️ Users with actionType items but no pageView items\", \"At least 1 user has a click event without a pageView event. Implement pageViews and Click Analytics on the same pages of the experience.\"]\r\n;\r\nlet data = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n;\r\nlet Code1Check = data\r\n| summarize Occurrences=countif(isnotempty({ConversionScope})), Total=count()\r\n| project Code = case(Occurrences == 0, 1, 0), Occurrences, Units=\"Row(s)\", Total\r\n;\r\nlet Code2Check = data\r\n| summarize UserCount=dcount({ConversionScope}, 4) by session_Id\r\n| summarize Occurrences=countif(UserCount > 1), Total=count()\r\n| project Code = case(Occurrences > 0, 2, 0), Occurrences, Units=\"Session(s)\", Total\r\n;\r\nlet Code3Check = data\r\n| summarize Occurrences=countif(isnull(customDimensions.actionType) and isnotempty({ConversionScope})), Total=count()\r\n| project Code = case(Occurrences > 0, 3, 0), Occurrences, Units=\"Row(s)\", Total\r\n;\r\nlet Code4Check = data\r\n| summarize Occurrences=countif(isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})), Total=count()\r\n| project Code = case(Occurrences > 0, 4, 0), Occurrences, Units=\"Row(s)\", Total\r\n;\r\nlet Code5Check = data\r\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\r\n| join kind = leftanti (pageViews | where itemType == \"pageView\" and isnotempty({ConversionScope}) | distinct {ConversionScope}) \r\non {ConversionScope}\r\n| summarize Occurrences = dcount({ConversionScope}, 4), One=1\r\n| join kind=inner (customEvents| union pageViews| summarize Total=dcount({ConversionScope}), One=1)\r\non One\r\n| project Code = case(Occurrences > 0, 5, 0), Occurrences, Units=\"User(s)\", Total\r\n;\r\nunion Code1Check, Code2Check, Code3Check, Code4Check, Code5Check\r\n| join (WarningCodes) on Code\r\n| where Code > 0\r\n| project Warning, Occurrences=strcat(Occurrences, \" \", Units), Pct = Occurrences*1.0 / Total, [\"Suggested Resolution\"] = Resolution\r\n| order by Pct desc\r\n\r\n",
                    "size": 1,
                    "queryType": 0,
                    "resourceType": "microsoft.insights/components",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Warning",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "60ch"
                          }
                        },
                        {
                          "columnMatch": "Pct",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "10ch"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "percent",
                              "useGrouping": false,
                              "minimumSignificantDigits": 3,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Suggested Resolution",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "118ch"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "100",
                  "name": "Telemetry Warnings"
                }
              ]
            },
            "name": "Telemetry Warnings"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Data Validation",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Data Validation\r\nThe Attribute Completion grids below display the Completion % of the required attributes for the HEART Framework. Note that **these grids only consider records with a non-empty {ConversionScope}** to disregard any user-initiated back-end events.\r\n### How do I interpret Completion%? Is 100% necessary to calculate HEART Metrics? \r\nCompletion represents the proportion of records with a value. For example, a Completion% of 25% for parentId means that 75% of records have no value. For the most informed product decisions, Completion% above 90% is recommended for each required attribute. HEART Metrics can still be calculated with a lower Completion%; however, a lower Completion% could result in HEART Metrics calculated on an unrepresentative dataset."
                  },
                  "name": "Technical Requirements Text"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let customEventsPack = customEvents \r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n| where isnotempty({ConversionScope})\r\n| project array = pack_array(*), Dummy = 1\r\n;\r\nlet customEventsAttributes = customEvents\r\n| getschema \r\n| project ColumnName, ColumnOrdinal, Dummy = 1\r\n| join kind = inner (customEventsPack) on Dummy\r\n| project ColumnName, value = tostring(array[ColumnOrdinal])\r\n| where ColumnName in (\"user_AuthenticatedId\", \"session_Id\", \"appName\", \"itemType\", \"timestamp\", \"operation_Id\", \"user_Id\")\r\n| summarize Complete=countif(value !in (\"\", \"not_specified\")), Rows=count() by ColumnName\r\n| project Source=\"customEvents\", Implementation=\"default\", Attribute=ColumnName, Rows, Complete\r\n;\r\nlet UnpackCD = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n| where isnotempty({ConversionScope})\r\n| project customDimensions\r\n| evaluate bag_unpack(customDimensions)\r\n;\r\nlet ClickAnalyticsAttributes = UnpackCD\r\n| getschema \r\n| project ColumnName, ColumnOrdinal, Dummy = 1\r\n| join kind = inner (UnpackCD | project array = pack_array(*), Dummy = 1) on Dummy\r\n| project ColumnName, value = tostring(array[ColumnOrdinal])\r\n| where ColumnName in (\"parentId\", \"pageName\", \"actionType\")\r\n| summarize Complete=countif(value !in (\"\", \"not_specified\")), Rows=count() by ColumnName\r\n| project Source=\"customEvents\", Implementation=\"Click Analytics\", Attribute=ColumnName, Rows, Complete\r\n;\r\nlet pageViewsPack = pageViews \r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n| where isnotempty({ConversionScope})\r\n| project array = pack_array(*), Dummy = 1\r\n;\r\nlet pageViewsAttributes=pageViews\r\n| getschema \r\n| project ColumnName, ColumnOrdinal, Dummy = 1\r\n| join kind = inner (pageViewsPack) on Dummy\r\n| project ColumnName, value = tostring(array[ColumnOrdinal])\r\n| where ColumnName in (\"user_AuthenticatedId\", \"session_Id\", \"appName\", \"timestamp\", \"operation_Id\", \"user_Id\")\r\n| summarize Complete=countif(value !in (\"\", \"not_specified\")), Rows=count() by ColumnName\r\n| project Source=\"pageViews\", Implementation=\"default\", Attribute=ColumnName, Rows, Complete\r\n;\r\nunion customEventsAttributes, ClickAnalyticsAttributes, pageViewsAttributes\r\n| extend Completion = Complete * 1.0 / Rows\r\n| project Status=case(Completion >= 0.90, '✔️ Good', '⚠️ Low Completion'), Source, Implementation, Attribute, Completion=coalesce(case(isnan(Completion), 0.0, Completion ), 0.0), Complete, Rows\r\n| order by Completion asc, Source asc, Implementation asc, Attribute asc\r\n",
                    "size": 0,
                    "title": "Attribute Completion",
                    "queryType": 0,
                    "resourceType": "microsoft.insights/components",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Completion",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "max": 1,
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "percent",
                              "minimumSignificantDigits": 2,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "ColumnName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "26ch"
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "Status"
                        },
                        {
                          "columnId": "Source"
                        },
                        {
                          "columnId": "Implementation"
                        },
                        {
                          "columnId": "Attribute"
                        },
                        {
                          "columnId": "Completion",
                          "label": "Completion%"
                        },
                        {
                          "columnId": "Complete"
                        },
                        {
                          "columnId": "Rows"
                        }
                      ]
                    }
                  },
                  "customWidth": "100",
                  "name": "Attribute Completion"
                }
              ]
            },
            "name": "Data Validation"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Data Retention",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Data Retention\r\nLearn more about data retention in the [Application Insights documentation](https://docs.microsoft.com/en-us/azure/azure-monitor/app/pricing#change-the-data-retention-period). For the most informed product decisions, at least 13 months of data is recommended to consider seasonality and year-over-year growth. "
                  },
                  "name": "Data Retention"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "customEvents\r\n| summarize [\"First Record\"]=min(timestamp), [\"Most Recent Record\"]=max(timestamp) by appName\r\n| order by [\"Most Recent Record\"] desc",
                    "size": 4,
                    "queryType": 0,
                    "resourceType": "microsoft.insights/components",
                    "crossComponentResources": [
                      "{Resource}"
                    ]
                  },
                  "name": "Records"
                }
              ]
            },
            "name": "Data Retention"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Technical"
      },
      "name": "Technical Validation"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
