{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::all"
        ],
        "parameters": [
          {
            "id": "88df9a87-9c9f-4b69-918e-eb6d70e5c1c6",
            "version": "KqlParameterItem/1.0",
            "name": "SqlMonitoringProfile",
            "type": 1,
            "description": "Set the default subscription retrieved from SQL Server Insights Template",
            "value": "",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "38e8be22-d88c-4a9e-8933-f84f495e1aef",
            "version": "KqlParameterItem/1.0",
            "name": "MonitoringProfile",
            "type": 5,
            "isRequired": true,
            "value": null,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "8f5b97db-4d2a-49d4-9f49-a73a9b002ab7",
            "version": "KqlParameterItem/1.0",
            "name": "Associations",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[]",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "5a0e004e-b906-40e2-9d95-ed370245eaef",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "type": 5,
            "isRequired": true,
            "query": "Resources\r\n| where id =~ '{MonitoringProfile}'\r\n| project rg = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup)\r\n| project value = rg, label = rg, selected = true",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "7bae1632-f3b2-402e-b4ca-5d9870343c3c",
            "version": "KqlParameterItem/1.0",
            "name": "Workspaces",
            "type": 5,
            "isRequired": true,
            "value": null,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "conditionalVisibility": {
        "parameterName": "visible",
        "comparison": "isEqualTo",
        "value": "false"
      },
      "name": "parameters - 1"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "value::all"
              ],
              "parameters": [
                {
                  "id": "55ca83d6-c66a-4869-a02f-4f8dcfa1a67e",
                  "version": "KqlParameterItem/1.0",
                  "name": "ResourceGroup",
                  "label": "Resource group",
                  "type": 5,
                  "isRequired": true,
                  "query": "Resources\r\n| where id =~ '{MonitoringProfile}'\r\n| project rg = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup)\r\n| project value = rg, label = rg, selected = true",
                  "crossComponentResources": [
                    "value::all"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                }
              ],
              "style": "above",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "name": "parameters - 2"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "nav",
              "links": [
                {
                  "id": "040d1ae4-6692-4937-9588-20a7ae073808",
                  "cellValue": "{MonitoringProfile}",
                  "linkTarget": "Resource",
                  "linkLabel": "{MonitoringProfile:name}",
                  "preText": "Profile: ",
                  "style": "link"
                },
                {
                  "id": "98b6e325-9253-40c1-aac5-871e26dc2db1",
                  "cellValue": "{Workspaces}",
                  "linkTarget": "Resource",
                  "linkLabel": "{Workspaces:name}",
                  "preText": "Workspace: ",
                  "style": "link"
                }
              ]
            },
            "name": "Resource links"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "nav",
              "links": [
                {
                  "id": "657f86c3-9ab9-4c46-abb2-48c6ccfe70bb",
                  "linkTarget": "WorkbookTemplate",
                  "linkLabel": "Add monitoring machine",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "workbookContext": {
                    "componentIdSource": "workbook",
                    "resourceIdsSource": "parameter",
                    "resourceIds": "MonitoringProfile",
                    "templateIdSource": "static",
                    "templateId": "Community-Workbooks/Workloads-AMA/Add monitoring virtual machine",
                    "typeSource": "static",
                    "type": "workload-onboarding",
                    "gallerySource": "static",
                    "gallery": "Azure Monitor",
                    "locationSource": "default",
                    "passSpecificParams": true,
                    "templateParameters": [
                      {
                        "name": "MonitoringProfile",
                        "source": "parameter",
                        "value": "MonitoringProfile"
                      },
                      {
                        "name": "SqlMonitoringProfile",
                        "source": "parameter",
                        "value": "SqlMonitoringProfile"
                      }
                    ]
                  }
                }
              ]
            },
            "name": "Action links",
            "styleSettings": {
              "margin": "10px 0 5px -10px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\n| take 1\n| project associations = dynamic([{Associations}])\n| mvexpand associations limit 400\n| project id = tolower(extract(@'(?i)(.+)/providers/microsoft.insights/datacollectionruleassociations/.+', 1, tostring(associations)))\n| join kind = inner (Resources\n  | where type =~ 'microsoft.compute/virtualmachines'\n  | extend id = tolower(id)\n  ) on id\n| project Vm = id, Status = 'Monitoring', Subscription = strcat('/subscriptions/', subscriptionId), ResourceGroup = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup), location = location, Action = 'Configure'",
              "size": 0,
              "title": "Monitoring state",
              "noDataMessage": "This profile does not have any associated monitoring virtual machines. Associate one using the Add monitoring machine button.",
              "noDataMessageStyle": 4,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "location",
                    "formatter": 17
                  },
                  {
                    "columnMatch": "Action",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "WorkbookTemplate",
                      "linkIsContextBlade": true,
                      "workbookContext": {
                        "componentIdSource": "workbook",
                        "resourceIdsSource": "column",
                        "resourceIds": "Vm",
                        "templateIdSource": "static",
                        "templateId": "Community-Workbooks/Workloads-AMA/Update monitoring vm config",
                        "typeSource": "static",
                        "type": "workload-onboarding",
                        "gallerySource": "static",
                        "gallery": "Azure Monitor",
                        "locationSource": "default",
                        "passSpecificParams": true,
                        "templateParameters": [
                          {
                            "name": "VirtualMachine",
                            "source": "column",
                            "value": "Vm"
                          }
                        ]
                      },
                      "templateRunContext": {
                        "componentIdSource": "parameter",
                        "componentId": "ResourceGroup",
                        "templateUriSource": "static",
                        "templateUri": "Community-Workbooks/Workloads-AMA/Update monitoring vm config",
                        "templateParameters": [
                          {
                            "name": "VirtualMachine",
                            "source": "column",
                            "value": "Vm",
                            "kind": "stringValue"
                          }
                        ],
                        "titleSource": "static",
                        "descriptionSource": "static",
                        "description": "",
                        "runLabelSource": "static"
                      }
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Vm",
                    "label": "Virtual machine"
                  },
                  {
                    "columnId": "ResourceGroup",
                    "label": "Resource group"
                  },
                  {
                    "columnId": "location",
                    "label": "Location"
                  }
                ]
              }
            },
            "showPin": false,
            "name": "query - 2"
          }
        ]
      },
      "name": "group - 0"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}