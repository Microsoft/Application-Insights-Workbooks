{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookNames": {
      "type": "object",
      "defaultValue": {
        "Query": "[guid(resourceGroup().id, 'Query')]",
        "Database": "[guid(resourceGroup().id, 'Database')]"
      }
    }
  },
  "variables": {
    "workbookMarkup": {
      "version": "Notebook/1.0",
      "items": [
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "crossComponentResources": [
              "{WsResourcesInternal}"
            ],
            "parameters": [
              {
                "id": "4ecc9f52-2e3f-4c8e-b9ea-f3e2f2583f5b",
                "version": "KqlParameterItem/1.0",
                "name": "WsResources",
                "type": 1
              },
              {
                "id": "f3e20cbc-b692-4b3d-8916-2fd0662ecfe6",
                "version": "KqlParameterItem/1.0",
                "name": "WsResourcesInternal",
                "type": 5,
                "query": "where id in~ ({WsResources})\r\n| project id, selected=1",
                "crossComponentResources": [
                  "value::all"
                ],
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "showDefault": false
                },
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
              },
              {
                "id": "30b86356-1bba-4603-83d1-835b99171066",
                "version": "KqlParameterItem/1.0",
                "name": "Timerange",
                "type": 4,
                "value": {
                  "durationMs": 86400000
                },
                "typeSettings": {
                  "selectableValues": [
                    {
                      "durationMs": 300000
                    },
                    {
                      "durationMs": 900000
                    },
                    {
                      "durationMs": 1800000
                    },
                    {
                      "durationMs": 3600000
                    },
                    {
                      "durationMs": 14400000
                    },
                    {
                      "durationMs": 43200000
                    },
                    {
                      "durationMs": 86400000
                    },
                    {
                      "durationMs": 172800000
                    },
                    {
                      "durationMs": 259200000
                    },
                    {
                      "durationMs": 604800000
                    },
                    {
                      "durationMs": 1209600000
                    },
                    {
                      "durationMs": 2419200000
                    },
                    {
                      "durationMs": 2592000000
                    },
                    {
                      "durationMs": 5184000000
                    },
                    {
                      "durationMs": 7776000000
                    }
                  ]
                }
              },
              {
                "id": "f2ae16b9-0bea-4ad0-b14e-93a51424fab9",
                "version": "KqlParameterItem/1.0",
                "name": "DBWorkbook",
                "type": 1,
                "value": "[resourceId('microsoft.insights/workbooks', parameters('workbookNames').Database)]"
              },
              {
                "id": "2f3b41da-04b0-4390-b630-66f6409add65",
                "version": "KqlParameterItem/1.0",
                "name": "QueryHash",
                "type": 1
              },
              {
                "id": "2c2f0c8e-d2d5-43a2-81e5-f6a24a708726",
                "version": "KqlParameterItem/1.0",
                "name": "ResourceName",
                "type": 1,
                "value": ""
              },
              {
                "id": "6ac48c43-56f4-4ecc-b012-6842b8951514",
                "version": "KqlParameterItem/1.0",
                "name": "Type",
                "type": 1
              },
              {
                "id": "0409d1db-76c6-4b5a-9157-52906527c27d",
                "version": "KqlParameterItem/1.0",
                "name": "dbType",
                "type": 1
              },
              {
                "id": "423aa443-3d9f-4598-8928-681e3532f554",
                "version": "KqlParameterItem/1.0",
                "name": "MonitoredResources",
                "type": 9,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "InsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_runtime_stats'\r\n| distinct Tags\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| project dbName = tolower(strcat(extract(\"^([^\\\\.]+)\\\\.?\", 1, sql_instance), '/', database_name))\r\n| distinct dbName",
                "crossComponentResources": [
                  "{WsResourcesInternal}"
                ],
                "value": null,
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
              },
              {
                "id": "36e0f6ea-0edb-451d-b932-9bb615413d9a",
                "version": "KqlParameterItem/1.0",
                "name": "Resources_query",
                "type": 9,
                "multiSelect": true,
                "quote": "",
                "delimiter": ",",
                "query": "where type contains '{Type}'\r\n| extend ResourceId = tolower(id)\r\n| extend name = tolower(strcat(extract(tolower('/{Type}/([^/]+)/'), 1, ResourceId), '/', name))\r\n| where name in ({MonitoredResources})\r\n| project strcat('{\"name\":\"',name, '\" , \"subscription\": \"', subscriptionId, '\", \"resourceGroup\": \"', resourceGroup, '\"}')",
                "crossComponentResources": [
                  "value::all"
                ],
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "value": null
              },
              {
                "id": "54b3cdbc-aa4b-478d-a936-59bd75bc8ec7",
                "version": "KqlParameterItem/1.0",
                "name": "queryText",
                "type": 1,
                "query": "InsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace == 'sqlserver_requests'\r\n| summarize make_bag(pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| where query_hash == '{QueryHash}'\r\n| top 1 by TimeGenerated desc\r\n| project statement_text",
                "crossComponentResources": [
                  "{WsResourcesInternal}"
                ],
                "typeSettings": {
                  "multiLineText": true,
                  "editorLanguage": "sql"
                },
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "Timerange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
              }
            ],
            "style": "pills",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "conditionalVisibility": {
            "parameterName": "hide",
            "comparison": "isNotEqualTo"
          },
          "name": "parameters - 0"
        },
        {
          "type": 1,
          "content": {
            "json": "# Query\r\nQuery hash: {QueryHash}"
          },
          "name": "text - 3"
        },
        {
          "type": 1,
          "content": {
            "json": "-- Get query text by connecting to database and executing the query below\r\n\r\nSELECT qt.query_sql_text query_text, q.query_hash\r\nFROM sys.query_store_query q \r\n    JOIN sys.query_store_query_text qt\r\n    ON q.query_text_id = qt.query_text_id \r\nWHERE q.query_hash = {QueryHash}",
            "style": "info"
          },
          "conditionalVisibility": {
            "parameterName": "queryText",
            "comparison": "isEqualTo"
          },
          "name": "text - 14"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "loadType": "explicit",
            "loadButtonText": "View Text",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "```sql\r\n{queryText}\r\n```"
                },
                "name": "text - 9"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "queryText",
            "comparison": "isNotEqualTo"
          },
          "name": "group - 10"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "title": "Duration",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "set truncationmaxrecords=5000;\r\nInsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_runtime_stats'\r\n| summarize make_bag( pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where query_hash == \"{QueryHash}\" \r\n| summarize max_duration = max(max_duration)/1000000,\r\navg_duration = sum(avg_duration*count_executions)/sum(count_executions)/1000000,\r\navg_cpu = sum(avg_cpu_time*count_executions)/sum(count_executions)/1000000,\r\nexecutions_count = sum(count_executions)\r\n    by resourceName\r\n| project Type = '{Type}/DATABASES', ResourceId = resourceName,\r\n    max_duration,\r\n    avg_duration,\r\n    avg_cpu,\r\n    executions_count,resourceName,\r\n    wbLink='{DBWorkbook}'\r\n| sort by avg_duration desc",
                  "size": 0,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "exportFieldName": "resourceName",
                  "exportParameterName": "ResourceName",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Type",
                        "formatter": 16,
                        "formatOptions": {
                          "showIcon": true,
                          "customColumnWidthSetting": "4ch"
                        }
                      },
                      {
                        "columnMatch": "ResourceId",
                        "formatter": 7,
                        "formatOptions": {
                          "linkColumn": "wbLink",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "workbook",
                            "templateIdSource": "column",
                            "templateId": "wbLink",
                            "typeSource": "workbook",
                            "gallerySource": "workbook",
                            "locationSource": "default"
                          }
                        }
                      },
                      {
                        "columnMatch": "max_duration",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "avg_duration",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "avg_cpu",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "executions_count",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "10ch"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "resourceName",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "wbLink",
                        "formatter": 5
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "Type",
                        "label": " "
                      },
                      {
                        "columnId": "ResourceId",
                        "label": "Database"
                      },
                      {
                        "columnId": "max_duration",
                        "label": "Max"
                      },
                      {
                        "columnId": "avg_duration",
                        "label": "Avg"
                      },
                      {
                        "columnId": "avg_cpu",
                        "label": "CPU"
                      },
                      {
                        "columnId": "executions_count",
                        "label": "Execs"
                      },
                      {
                        "columnId": "resourceName"
                      },
                      {
                        "columnId": "wbLink"
                      }
                    ]
                  }
                },
                "customWidth": "40",
                "name": "query - 3"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "set truncationmaxrecords=5000;\r\nInsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_runtime_stats'\r\n| summarize make_bag( pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where resourceName contains '{ResourceName}'\r\n| where query_hash == \"{QueryHash}\" \r\n| summarize avg_duration = sum(avg_duration*count_executions)/sum(count_executions)/1000000,\r\navg_cpu = sum(avg_cpu_time*count_executions)/sum(count_executions)/1000000\r\n    by bin(interval_start_time, {Timerange:grain})",
                  "size": 0,
                  "aggregation": 3,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "visualization": "linechart",
                  "chartSettings": {
                    "ySettings": {
                      "numberFormatSettings": {
                        "unit": 24,
                        "options": {
                          "style": "decimal",
                          "useGrouping": true
                        }
                      }
                    }
                  }
                },
                "customWidth": "60",
                "name": "query - 2"
              }
            ]
          },
          "name": "group - 15"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "title": "Waits Duration",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_wait_stats'\r\n| summarize make_bag( pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where query_hash == \"{QueryHash}\" \r\n| summarize avg_wait_time = sum(total_query_wait_time_ms)/sum(count_executions) / 1000\r\n    by resourceName, wait_category = wait_category\r\n| project Type = '{Type}/DATABASES', ResourceId = resourceName,\r\n resourceName ,\r\nwait_category, avg_wait_time, \r\n    wbLink='{DBWorkbook}'\r\n| sort by avg_wait_time desc",
                  "size": 0,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "exportFieldName": "resourceName",
                  "exportParameterName": "ResourceName",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Type",
                        "formatter": 16,
                        "formatOptions": {
                          "showIcon": true,
                          "customColumnWidthSetting": "4ch"
                        }
                      },
                      {
                        "columnMatch": "ResourceId",
                        "formatter": 7,
                        "formatOptions": {
                          "linkColumn": "wbLink",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "workbook",
                            "templateIdSource": "column",
                            "templateId": "wbLink",
                            "typeSource": "workbook",
                            "gallerySource": "workbook",
                            "locationSource": "default"
                          }
                        }
                      },
                      {
                        "columnMatch": "resourceName",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "wait_category",
                        "formatter": 0,
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "avg_wait_time",
                        "formatter": 0,
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "wbLink",
                        "formatter": 5
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "Type",
                        "label": " "
                      },
                      {
                        "columnId": "ResourceId",
                        "label": "Database"
                      },
                      {
                        "columnId": "resourceName"
                      },
                      {
                        "columnId": "wait_category",
                        "label": "Wait Category"
                      },
                      {
                        "columnId": "avg_wait_time",
                        "label": "Avg"
                      },
                      {
                        "columnId": "wbLink"
                      }
                    ]
                  }
                },
                "customWidth": "40",
                "name": "query - 3 - Copy"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_wait_stats'\r\n| summarize make_bag(pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where resourceName contains '{ResourceName}'\r\n| where query_hash == \"{QueryHash}\" \r\n| summarize total = sum(total_query_wait_time_ms)/1000\r\n    by bin(interval_start_time, {Timerange:grain})",
                  "size": 0,
                  "aggregation": 3,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "visualization": "linechart",
                  "chartSettings": {
                    "ySettings": {
                      "numberFormatSettings": {
                        "unit": 24,
                        "options": {
                          "style": "decimal",
                          "useGrouping": true
                        }
                      }
                    }
                  }
                },
                "customWidth": "60",
                "name": "query - 2 - Copy"
              }
            ]
          },
          "name": "group - 14"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "title": "CPU",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "set truncationmaxrecords=5000;\r\nInsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_runtime_stats'\r\n| summarize make_bag( pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where query_hash == \"{QueryHash}\" \r\n| summarize max = max(max_cpu_time)/1000000, \r\navg = sum(avg_cpu_time*count_executions)/sum(count_executions)/1000000, execs = sum(count_executions) by resourceName\r\n| project Type = '{Type}/DATABASES', ResourceId = resourceName,\r\nmax, avg, execs, \r\n    wbLink='{DBWorkbook}', resourceName\r\n| sort by max desc",
                  "size": 0,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "exportFieldName": "resourceName",
                  "exportParameterName": "ResourceName",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Type",
                        "formatter": 16,
                        "formatOptions": {
                          "showIcon": true,
                          "customColumnWidthSetting": "4ch"
                        }
                      },
                      {
                        "columnMatch": "ResourceId",
                        "formatter": 7,
                        "formatOptions": {
                          "linkColumn": "wbLink",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "workbook",
                            "templateIdSource": "column",
                            "templateId": "wbLink",
                            "typeSource": "workbook",
                            "gallerySource": "workbook",
                            "locationSource": "default"
                          }
                        }
                      },
                      {
                        "columnMatch": "max",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "avg",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "execs",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "wbLink",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "resourceName",
                        "formatter": 5
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "Type",
                        "label": " "
                      },
                      {
                        "columnId": "ResourceId",
                        "label": "Database"
                      },
                      {
                        "columnId": "max",
                        "label": "Max"
                      },
                      {
                        "columnId": "avg",
                        "label": "Avg"
                      },
                      {
                        "columnId": "execs",
                        "label": "Execs"
                      },
                      {
                        "columnId": "wbLink"
                      },
                      {
                        "columnId": "resourceName"
                      }
                    ]
                  }
                },
                "customWidth": "40",
                "name": "query - 3 - Copy - Copy"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "set truncationmaxrecords=5000;\r\nInsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_runtime_stats'\r\n| summarize make_bag( pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where resourceName contains '{ResourceName}'\r\n| where query_hash == \"{QueryHash}\" \r\n| summarize max = max(max_cpu_time)/1000000, \r\navg = sum(avg_cpu_time*count_executions)/sum(count_executions)/1000000\r\n    by bin(interval_start_time, {Timerange:grain})",
                  "size": 0,
                  "aggregation": 3,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "visualization": "linechart",
                  "chartSettings": {
                    "ySettings": {
                      "numberFormatSettings": {
                        "unit": 24,
                        "options": {
                          "style": "decimal",
                          "useGrouping": true
                        }
                      }
                    }
                  }
                },
                "customWidth": "60",
                "name": "query - 2 - Copy - Copy"
              }
            ]
          },
          "name": "group - 13"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "title": "Data IO",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "set truncationmaxrecords=5000;\r\nInsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_runtime_stats'\r\n| summarize make_bag( pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n|where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where query_hash == \"{QueryHash}\"\r\n| summarize max = max(max_physical_io_reads), \r\navg = sum(avg_physical_io_reads*count_executions)/sum(count_executions), execs = sum(count_executions) by resourceName\r\n| project Type = '{Type}/DATABASES', ResourceId = resourceName,\r\nmax, avg, execs,  \r\n    wbLink='{DBWorkbook}', resourceName\r\n| sort by max desc ",
                  "size": 0,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "exportFieldName": "resourceName",
                  "exportParameterName": "ResourceName",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Type",
                        "formatter": 16,
                        "formatOptions": {
                          "showIcon": true,
                          "customColumnWidthSetting": "4ch"
                        }
                      },
                      {
                        "columnMatch": "ResourceId",
                        "formatter": 7,
                        "formatOptions": {
                          "linkColumn": "wbLink",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "workbook",
                            "templateIdSource": "column",
                            "templateId": "wbLink",
                            "typeSource": "workbook",
                            "gallerySource": "workbook",
                            "locationSource": "default"
                          }
                        }
                      },
                      {
                        "columnMatch": "max",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "avg",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "execs",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "wbLink",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "resourceName",
                        "formatter": 5
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "Type",
                        "label": " "
                      },
                      {
                        "columnId": "ResourceId",
                        "label": "Database"
                      },
                      {
                        "columnId": "max",
                        "label": "Max"
                      },
                      {
                        "columnId": "avg",
                        "label": "Avg"
                      },
                      {
                        "columnId": "execs",
                        "label": "Execs"
                      },
                      {
                        "columnId": "wbLink"
                      },
                      {
                        "columnId": "resourceName"
                      }
                    ]
                  }
                },
                "customWidth": "40",
                "name": "query - 3 - Copy - Copy - Copy"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "set truncationmaxrecords=5000;\r\nInsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_runtime_stats'\r\n| summarize make_bag( pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where resourceName contains '{ResourceName}'\r\n| where query_hash == \"{QueryHash}\"\r\n| summarize max = max(max_physical_io_reads), \r\navg = sum(avg_physical_io_reads*count_executions)/sum(count_executions)\r\n    by bin(interval_start_time, {Timerange:grain})",
                  "size": 0,
                  "aggregation": 3,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "visualization": "linechart",
                  "chartSettings": {
                    "ySettings": {
                      "numberFormatSettings": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "useGrouping": true
                        }
                      }
                    }
                  }
                },
                "customWidth": "60",
                "name": "query - 2 - Copy - Copy - Copy"
              }
            ]
          },
          "name": "group - 12"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "title": "LOG IO",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "set truncationmaxrecords=5000;\r\nInsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_runtime_stats'\r\n| summarize make_bag( pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where query_hash == \"{QueryHash}\"\r\n| summarize max = max(max_logical_io_reads), \r\navg = sum(avg_logical_io_reads*count_executions)/sum(count_executions), execs = sum(count_executions) by resourceName\r\n| project Type = '{Type}/DATABASES', ResourceId = resourceName,\r\nmax, avg, execs, \r\n    wbLink='{DBWorkbook}',resourceName\r\n| sort by max desc ",
                  "size": 0,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "exportFieldName": "resourceName",
                  "exportParameterName": "ResourceName",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Type",
                        "formatter": 16,
                        "formatOptions": {
                          "showIcon": true,
                          "customColumnWidthSetting": "4ch"
                        }
                      },
                      {
                        "columnMatch": "ResourceId",
                        "formatter": 7,
                        "formatOptions": {
                          "linkColumn": "wbLink",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "workbook",
                            "templateIdSource": "column",
                            "templateId": "wbLink",
                            "typeSource": "workbook",
                            "gallerySource": "workbook",
                            "locationSource": "default"
                          }
                        }
                      },
                      {
                        "columnMatch": "max",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "avg",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "execs",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "11ch"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "wbLink",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "resourceName",
                        "formatter": 5
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "Type",
                        "label": " "
                      },
                      {
                        "columnId": "ResourceId",
                        "label": "Database"
                      },
                      {
                        "columnId": "max",
                        "label": "Max"
                      },
                      {
                        "columnId": "avg",
                        "label": "Avg"
                      },
                      {
                        "columnId": "execs",
                        "label": "Execs"
                      },
                      {
                        "columnId": "wbLink"
                      },
                      {
                        "columnId": "resourceName"
                      }
                    ]
                  }
                },
                "customWidth": "40",
                "name": "query - 3 - Copy - Copy - Copy - Copy"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "set truncationmaxrecords=5000;\r\nInsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_runtime_stats'\r\n| summarize make_bag( pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where resourceName contains '{ResourceName}'\r\n| where query_hash == \"{QueryHash}\"\r\n| summarize max = max(max_logical_io_reads), \r\navg = sum(avg_logical_io_reads*count_executions)/sum(count_executions)\r\n    by bin(interval_start_time, {Timerange:grain})",
                  "size": 0,
                  "aggregation": 3,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "visualization": "linechart",
                  "chartSettings": {
                    "ySettings": {
                      "numberFormatSettings": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "useGrouping": true
                        }
                      }
                    }
                  }
                },
                "customWidth": "60",
                "name": "query - 2 - Copy - Copy - Copy - Copy"
              }
            ]
          },
          "name": "group - 10"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "title": "Executions",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "set truncationmaxrecords=5000;\r\nInsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_runtime_stats'\r\n| summarize make_bag( pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where query_hash == \"{QueryHash}\" \r\n| summarize execs = sum(count_executions) by resourceName\r\n| project Type = '{Type}/DATABASES', ResourceId = resourceName,\r\nexecs, \r\n    wbLink='{DBWorkbook}', resourceName\r\n| sort by execs desc",
                  "size": 0,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "exportFieldName": "resourceName",
                  "exportParameterName": "ResourceName",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Type",
                        "formatter": 16,
                        "formatOptions": {
                          "showIcon": true,
                          "customColumnWidthSetting": "4ch"
                        }
                      },
                      {
                        "columnMatch": "ResourceId",
                        "formatter": 7,
                        "formatOptions": {
                          "linkColumn": "wbLink",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "workbook",
                            "templateIdSource": "column",
                            "templateId": "wbLink",
                            "typeSource": "workbook",
                            "gallerySource": "workbook",
                            "locationSource": "default"
                          }
                        }
                      },
                      {
                        "columnMatch": "execs",
                        "formatter": 0,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "wbLink",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "resourceName",
                        "formatter": 5
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "Type",
                        "label": " "
                      },
                      {
                        "columnId": "ResourceId",
                        "label": "Database"
                      },
                      {
                        "columnId": "execs",
                        "label": "Execs"
                      },
                      {
                        "columnId": "wbLink"
                      },
                      {
                        "columnId": "resourceName"
                      }
                    ]
                  }
                },
                "customWidth": "40",
                "name": "query - 3 - Copy - Copy"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "set truncationmaxrecords=5000;\r\nInsightsMetrics\r\n| where Origin == 'solutions.azm.ms/telegraf/SqlInsights'\r\n| where Namespace matches regex 'sqlserver_azure.._querystore_runtime_stats'\r\n| summarize make_bag( pack(Name, Val)) by Tags, TimeGenerated\r\n| evaluate bag_unpack(bag_)\r\n| extend data = todynamic(Tags)\r\n| evaluate bag_unpack(data)\r\n| where measurement_db_type == '{dbType}'\r\n| extend resourceName = tolower(strcat(sql_instance, '/', database_name))\r\n| where resourceName contains '{ResourceName}'\r\n| where query_hash == \"{QueryHash}\" \r\n| summarize execs = sum(count_executions)\r\n    by bin(interval_start_time, {Timerange:grain})",
                  "size": 0,
                  "aggregation": 3,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "Timerange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{WsResourcesInternal}"
                  ],
                  "visualization": "linechart",
                  "chartSettings": {
                    "ySettings": {
                      "numberFormatSettings": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "useGrouping": true
                        }
                      }
                    }
                  }
                },
                "customWidth": "60",
                "name": "query - 2 - Copy - Copy"
              }
            ]
          },
          "name": "group - 11"
        }
      ],
      "fallbackResourceIds": [
      ],
      "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
    },
    "workbookDisplayName": "Query",
    "workbookName": "[parameters('workbookNames').Query]"
  },
  "resources": [
    {
      "name": "[variables('workbookName')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2018-06-17-preview",
      "kind": "shared",
      "properties": {
        "displayName": "[variables('workbookDisplayName')]",
        "serializedData": "[string(variables('workbookMarkup'))]",
        "version": "Notebook/1.0",
        "sourceId": "[resourceGroup().id]",
        "category": "workbook"
      },
      "tags": {
        "hidden-title": "[variables('workbookDisplayName')]"
      }
    }
  ]
}