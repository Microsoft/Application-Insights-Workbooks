{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json",
    "type": "object",
    "title": "Workbook template gallery schema",
    "required": [
        "version",
        "items",
        "$schema"
    ],
    "properties": {
        "version": {
            "$id": "#/properties/version",
            "type": "string",
            "title": "Workbook version",
            "default": "Notebook/1.0",
            "pattern": "^(.*)$"
        },
        "items": {
            "$id": "#/properties/items",
            "type": "array",
            "title": "Items in the template",
            "items": [
                {"$ref": "#/definitions/markdown"},
                {"$ref": "#/definitions/metric"}
            ]
        },
        "styleSettings": {
            "$id": "#/properties/styleSettings",
            "type": "object",
            "title": "Workbook style settings"
        },
        "$schema": {
            "$id": "#/properties/$schema",
            "type": "string",
            "title": "$schema",
            "default": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json",
            "examples": [
                "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
            ],
            "pattern": "^(.*)$"
        }
    },
    "definitions": {
        "markdown": {
            "$id": "#/definitions/markdown",
            "type": "object",
            "required": [
                "type",
                "content"
            ],
            "properties": {
                "type": {
                    "const": 1
                },
                "content": {
                    "type": "object",
                    "properties": {
                        "json": {
                            "type": "string",
                            "examples": [
                                "<h1>This is some markdown text</h1>"
                            ]
                        }
                    }
                },
                "name": {"$ref": "#/definitions/name"},
                "customWidth": {"$ref": "#/definitions/customWidth"},
                "showPin": {"$ref": "#/definitions/showPin"},
                "styleSettings": {"$ref": "#/definitions/styleSettings"},
                "conditionalVisibility": {"$ref": "#/definitions/conditionalVisibility"}
            }
        },
        "metric": {
            "$id": "#/definitions/metric",
            "type": "object",
            "required": [
                "type",
                "content"
            ],
            "properties": {
                "type": {
                    "const": 10
                },
                "content": {
                    "type": "object",
                    "properties": {
                        "chartId": {
                            "type": "string",
                            "description": "Name of the workbook step"
                        },
                        "version": {
                            "type": "string",
                            "description": "Version of metrics control",
                            "examples": ["MetricsItem/2.0"]
                        },        
                        "size": {
                            "type": "integer",
                            "description": "Size of the step"
                        },
                        "chartType": {
                            "type": "integer",
                            "description": "Name of the workbook step"
                        },
                        "resourceType": {
                            "type": "string",
                            "description": "The type of resources applied. Metric step can only support one resource type at one time",
                            "examples": ["microsoft.storage/storageaccounts"]
                        },
                        "resourceIds": {
                            "type": "array",
                            "description": "The resources or resource parameters applied"
                        },
                        "timeContext": {
                            "type": "object",
                            "description": "The time range applied"
                        },
                        "timeRangeFromParameter": {
                            "type": "string",
                            "description": "If a time range parameter is used, the id of the parameter"
                        },
                        "resourceParameter": {
                            "type": "string",
                            "description": "If a resource parameter is used, the id of the parameter"
                        },
                        "metrics": {
                            "type": "array",
                            "description": "The metrics applied",
                            "items": [{"$ref": "#/definitions/metricItem"}]
                        },
                        "resourceLimit": {
                            "type": "integer",
                            "description": "The maximum number of resources that can be queried"
                        },
                        "gridSettings": {"$ref": "#/definitions/gridSettings"},
                        "exportToExcelOptions":  {"$ref": "#/definitions/exportToExcelOptions"},
                        "showExportToExcel": {"$ref": "#/definitions/showExportToExcel"},
                        "title": {"$ref": "#/definitions/chartTitle"}
                    }
                },
                "name": {"$ref": "#/definitions/name"},
                "customWidth": {"$ref": "#/definitions/customWidth"},
                "showPin": {"$ref": "#/definitions/showPin"},
                "styleSettings": {"$ref": "#/definitions/styleSettings"},
                "conditionalVisibility": {"$ref": "#/definitions/conditionalVisibility"}
            }
        },
        "link": {
            "$id": "#/definitions/link",
            "type": "object",
            "properties": {
                "version": {
                    "type": "string",
                    "description": "Version of link step",
                    "examples": ["LinkItem/2.0"]
                },
                "style": {
                    "type": "string",
                    "description": "style of link",
                    "examples": ["bullets", "paragraph", "navigation"]
                },
                "links": {
                    "type": "array",
                    "items": [{"$ref": "#/definitions/linkItem"}]
                },
                "name": {"$ref": "#/definitions/name"},
                "customWidth": {"$ref": "#/definitions/customWidth"},
                "showPin": {"$ref": "#/definitions/showPin"},
                "styleSettings": {"$ref": "#/definitions/styleSettings"},
                "conditionalVisibility": {"$ref": "#/definitions/conditionalVisibility"}
            }
        },
        "name": {
            "$id": "#/definitions/name",
            "type": "string",
            "description": "Name of the workbook step"
        },
        "title": {
            "$id": "#/definitions/chartTitle",
            "type": "string",
            "description": "The title shown above the workbook step. *LOC*"
        },
        "customWidth": {
            "$id": "#/definitions/customWidth",
            "type": "string",
            "description": "The width of the markdown item",
            "examples": [
                "50"
            ]
        },
        "showExportToExcel": {
            "$id": "#/definitions/showExportToExcel",
            "type": "boolean",
            "description": "Show download to excel toolbar button"
        },
        "exportToExcelOptions": {
            "$id": "#/definitions/exportToExcelOptions",
            "type": "string",
            "description": "What fields in to be exported",
            "examples": ["visible", "all"]
        },
        "showPin": {
            "$id": "#/definitions/showPin",
            "type": "boolean",
            "description": "Show pin to dashboard button on this step"
        },
        "gridSettings": {
            "$id": "#/definitions/gridSettings",
            "type": "object",
            "properties": {
                "formatters": {
                    "type": "array",
                    "description": "the formatters applied to the columns",
                    "items":  [{"$ref": "#/definitions/formatters"}]
                },
                "labelSettings": {
                    "type": "array",
                    "items": [{"$ref": "#/definitions/gridLabelSettings"}],
                    "description": "Settings for custom column labels"
                },
                "filter": {
                    "type": "boolean",
                    "description": "Show the filter search box above the grid"
                },
                "rowLimit": {
                    "type": "integer",
                    "description": "The max number of rows to display for this grid"
                },
                "hierarchySettings": {
                    "type": "object",
                    "properties": {
                        "treeType": {
                            "type": "integer",
                            "description": "The hierarchy type"
                        },
                        "groupBy": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "description": "The column ids to group by"
                        },
                        "expandTopLevel": {
                            "type": "boolean",
                            "description": "Expand the top level of the grid by default"
                        },
                        "finalBy": {
                            "type": "string",
                            "description": "The column id to finally group by"
                        }
                    }
                },
                "sortBy": {
                    "type": "array",
                    "items": [{"$ref": "#/definitions/sortBy"}]
                }
            }
        },
        "gridLabelSettings": {
            "$id": "#/definitions/gridLabelSettings",
            "type": "object",
            "properties": {
                "columnId": {
                    "type": "string",
                    "description": "The id of the column"
                },
                "label": {
                    "type": "string",
                    "description": "The label of the column header. *LOC*"
                }
            }
        },
        "sortBy": {
            "$id": "#/definitions/sortBy",
            "type": "object",
            "properties": {
                "itemKey": {
                    "type": "string",
                    "description": "The column id"
                },
                "sortOrder": {
                    "type": "integer",
                    "description": "sort by asc, desc"
                }
            }
        },
        "formatters": {
            "$id": "#/definitions/formatters",
            "type": "object"
        },
        "styleSettings": {
            "$id": "#/definitions/styleSettings",
            "type": "object",
            "properties": {
                "margin": {
                    "type": "string",
                    "description": "margin on the step",
                    "examples": ["2px", "0 20px", "1px 2px 3px 4px"]
                },
                "padding": {
                    "type": "string",
                    "description": "padding on the step",
                    "examples": ["2px", "0 20px", "1px 2px 3px 4px"]
                },
                "maxWidth": {
                    "type": "string",
                    "description": "max width of the step",
                    "examples": ["100%", "20px"]
                },
                "progressStyle": {
                    "type": "string",
                    "description": "The loading icon shown on this step",
                    "examples": ["squares", "loader", "spinner", "none"]
                },
                "showBorder": {
                    "type": "boolean",
                    "description": "Show a border around the step"
                }
            }
        },
        "conditionalVisibility": {
            "$id": "#/definitions/conditionalVisibility",
            "type": "object",
            "properties": {
                "parameterName": {
                    "type": "string",
                    "description": "id of the parameter"
                },
                "comparison": {
                    "type": "string",
                    "examples": ["isEqualTo", "isNotEqualTo"]
                },
                "value": {
                    "type": "string",
                    "description": "the value of the condition"
                }
            } 
        },
        "metricItem": {
            "$id": "#/definitions/metricItem",
            "type": "object",
            "properties": {
                "namespace": {
                    "type": "string",
                    "description": "namespace of the metric"
                },
                "metric": {
                    "type": "string",
                    "description": "id of the metric ",
                    "examples": ["microsoft.storage/storageaccounts-Transaction-SuccessE2ELatency"]
                },
                "aggregation": {
                    "type": "integer",
                    "description": "Aggregation of the metric"
                },
                "splitBy": {
                    "type": "string",
                    "description": "On which dimension to segment this metric"
                },
                "splitBySortOrder": {
                    "type": "integer",
                    "description": "how to order the results of the metric segmentations"
                },
                "splitByLimit": {
                    "type": "integer",
                    "description": "the number of segments to view"
                },
                "columnName": {
                    "type": "string",
                    "description": "custom name of the column in grid or metric tile"
                }
            },
            "required": ["namespace", "metric", "aggregation"]
        },
        "linkItem": {
            "$id": "#/definitions/linkItem",
            "type": "object",
            "properties": {
                "linkTarget": {
                    "type": "string",
                    "description":"What the link should go to"
                },
                "linkLabel": {
                    "type": "string",
                    "description": "What the link should say. *LOC*"
                },
                "preText": {
                    "type": "string",
                    "description": "What text comes before the link. *LOC*"
                },
                "postText": {
                    "type": "string",
                    "description": "What text comes after the link. *LOC*"
                },
                "style": {
                    "type": "string",
                    "examples": ["link", "primary", "secondary"]
                },
                "linkIsContextBlade": {
                    "type": "boolean",
                    "description": "Open up the link in a context blade"
                }
            }

        }
    }
}